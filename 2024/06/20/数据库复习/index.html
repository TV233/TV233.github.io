<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="Tviak的普通观测站" href="https://blog.vktia.me/rss.xml"><link rel="alternate" type="application/atom+xml" title="Tviak的普通观测站" href="https://blog.vktia.me/atom.xml"><link rel="alternate" type="application/json" title="Tviak的普通观测站" href="https://blog.vktia.me/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="学习"><link rel="canonical" href="https://blog.vktia.me/2024/06/20/%E6%95%B0%E6%8D%AE%E5%BA%93%E5%A4%8D%E4%B9%A0/"><title>数据库复习 | Tviak's Observatory = Tviak的普通观测站 = 跨出自己的舒适区很难，但跨出去了就是成长。</title><meta name="generator" content="Hexo 6.2.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">数据库复习</h1><div class="meta"><span class="item" title="创建时间：2024-06-20 19:30:09"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2024-06-20T19:30:09+08:00">2024-06-20</time> </span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">本文字数</span> <span>19k</span> <span class="text">字</span> </span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">阅读时长</span> <span>26 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">Tviak's Observatory</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://cdn.jsdelivr.net/gh/TV233/blogpic@master/img/84179374_p0.jpg"></li><li class="item" data-background-image="https://cdn.jsdelivr.net/gh/TV233/blogpic@master/img/87825932_p0~1.jpg"></li><li class="item" data-background-image="https://cdn.jsdelivr.net/gh/TV233/blogpic@master/img/73619764_p0.png"></li><li class="item" data-background-image="https://cdn.jsdelivr.net/gh/TV233/blogpic@master/img/83842663_p30.jpg"></li><li class="item" data-background-image="https://cdn.jsdelivr.net/gh/TV233/blogpic@master/img/101460781_p0.jpg"></li><li class="item" data-background-image="https://cdn.jsdelivr.net/gh/TV233/blogpic@master/img/96874706_pa0.jpg"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://blog.vktia.me/2024/06/20/%E6%95%B0%E6%8D%AE%E5%BA%93%E5%A4%8D%E4%B9%A0/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="Tviak"><meta itemprop="description" content="跨出自己的舒适区很难，但跨出去了就是成长。, 观测世界和自己的一般通过观测者"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Tviak的普通观测站"></span><div class="body md" itemprop="articleBody"><h2 id="一-数据库及其系统概念"><a class="markdownIt-Anchor" href="#一-数据库及其系统概念">#</a> 一、数据库及其系统概念</h2><blockquote><ul><li>了解数据库、数据库管理系统、数据库系统等基本概念</li><li>理解数据模型与数据库类型关系</li><li>熟悉数据库系统组成及其各部分作用</li></ul></blockquote><p>数据库：按特定数据模型组织存储管理数据的文件集合</p><p>特点</p><ul><li>数据不重复</li><li>支持并发</li><li>数据结构独立于应用程序</li><li>数据的增删改查由数据库系统管理软件管理</li></ul><p>数据模型：事物对象数据特征结构的形式化表示，包括数据结构、数据操作、数据约束</p><p>数据结构：对象静态特征</p><p>数据操作：对象动态特征</p><p>数据约束：数据结构中数据之间的联系制约关系，数据动态变化的规则</p><p>数据模型 - 关系数据模型：采用 “二维表” 结构组织、存储和管理数据，并以关联列实现表之间的联系。</p><p>数据库系统（DS）</p><p>数据库应用程序：在 DBMS 支持下对数据库中数据进行访问处理</p><p>关系数据库数据内容：用户表（用户数据），系统表（元数据、索引数据、运行数据）</p><p>关系数据库对象组织：</p><ul><li>用户表：存储用户的应用数据</li><li>系统表：存储数据库系统自身数据</li><li>视图：通过虚拟表实现数据查询处理</li><li>索引：通过目录数据结构支持快速的数据查询</li><li>约束：对关系表及其数据施加规则</li><li>存储过程：在数据库内部实现特定功能程序的数据处理</li><li>触发器：在数据库内部实现数据操作事件触发自动执行的过程程序</li></ul><p>PostgreSQL 数据库主要对象</p><p>・架构（schema）对象</p><p>schema 是一个命名空间，它包含了数据库对象的名称，例如表、视图、索引、数据类型、函数以及运算符。一个数据库可以包含一个或多个 schema，而且同一个数据库中的不同 schema 可以拥有相同名字的表或其他对象。</p><p>・表（table）对象</p><p>是一个结构化的数据集，其中数据以行和列的形式存储。每一列代表一个属性，每一行代表一个数据记录。例如，一个名为 “Students” 的表可能有 “StudentID”、“LastName”、“FirstName” 和 “Age” 等列。</p><p>・视图（view）对象</p><p>视图是一个虚拟表，它的内容由查询定义。与表不同，视图并不在数据库中以存储的数据形式存在，而是在运行时动态生成。视图可以用于封装复杂的查询，简化数据访问，或者限制对基础表数据的访问。</p><p>・序列（sequence）对象</p><p>序列是一个数据库对象，用于生成一个唯一的整数序列。它常常用于生成主键字段的值。例如，每次插入新记录时，可以使用序列生成一个新的、唯一的 ID。</p><p>・函数（function）对象</p><p>在 PostgreSQL 中，函数是一段在服务器端执行的预编译的 PL/pgSQL 或其他语言（如 SQL、Python、Java 等）的代码。函数可以接受参数并返回结果。它们可以用于封装和重用复杂的 SQL 逻辑，或者执行不能用 SQL 表达的操作。</p><p>・存储过程（procedure）对象</p><p>存储过程类似于函数，但是它可以执行一些影响 SQL 事务的操作，如提交和回滚，而函数不能。存储过程在 PostgreSQL 11 中被引入。</p><p>・触发器（trigger）对象</p><p>触发器是一种特殊类型的存储过程，它在数据库表上的指定事件（如 INSERT、UPDATE 或 DELETE）发生时自动执行。触发器可以用于执行各种自动化的任务，如数据验证、数据转换和复杂的业务规则实施。</p><h2 id="二-关系模型"><a class="markdownIt-Anchor" href="#二-关系模型">#</a> 二、关系模型</h2><h3 id="21-关系相关概念"><a class="markdownIt-Anchor" href="#21-关系相关概念">#</a> 2.1 关系相关概念</h3><p>键：关系中可以唯一标识元组的属性列，其他的为非键列</p><p>候选键：多个列都可以作为键时，它们每一个均为候选键</p><p>主键：候选键中最具代表性的，唯一</p><p>复合键：关系中必须用多列才能唯一标识元组时，为复合主键</p><p>代理键：DBMS 自动生成的数字序列主键，可替代复合主键</p><p>外键：关系中的关键字为另一个关系的主键，此时称该关系为另一个关系的从表</p><p>关系模式：关系名（<u>主键属性</u>，属性 2，…，属性 x）</p><h3 id="22-关系模型原理"><a class="markdownIt-Anchor" href="#22-关系模型原理">#</a> 2.2 关系模型原理</h3><p>数据模型 - 关系模型：基于二维表结构存储数据实体及实体间联系</p><p>关系模型数据操作</p><p>集合：选择（select）、投影（project）、连接（join）、交（intersection）、并（union）、差（difference）</p><p>元组：行插入（Insert）、 修改（Update）、删除（Delete）</p><p>交并差：关系 R 与关系 S 需有相同属性组成（简单不赘述）</p><p>笛卡尔积 ×：R 的属性列 + S 的属性列 = 新表属性列，元组进行排列组合</p><p>选择：σF®：在关系 R 中选出满足条件 F 的元组形成新的关系。(F：条件表达式)；对应 where 子句</p><p>投影：πA（R）：在 R 中选出若干属性列组成一个新关系。(A: 属性组)；对应 select 子句</p><p>连接：从两个关系的笛卡尔积中选取属性间满足条件 AθB 的元组组成新的关系</p><p>条件连接</p><p><img data-src="https://cdn.jsdelivr.net/gh/TV233/blogpic@main//img/c5dc9cd345b74104b9a9ca7ed04fa8a5.png" alt="img"></p><p>等值连接 - 条件连接的特例：选取指定属性列的值相等的行，可以选择多个条件</p><p><img data-src="https://cdn.jsdelivr.net/gh/TV233/blogpic@main//img/548a9de4f4a949d9a7c8dc20760f9fea.png" alt="img"></p><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">SELECT</span> 列表</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">FROM</span> 表<span class="token number">1</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">JOIN</span> 表<span class="token number">2</span> <span class="token keyword">ON</span> 表<span class="token number">1.</span>列 <span class="token operator">=</span> 表<span class="token number">2.</span>列<span class="token punctuation">;</span></pre></td></tr></table></figure><p>自然连接 - 等值连接的特例：根据两个表中的所有相同属性列进行连接，连接后每一组相同属性列只保留一个</p><p><img data-src="https://cdn.jsdelivr.net/gh/TV233/blogpic@main//img/cce6ee67c2494d4485ca139bc792945d.png" alt="img"></p><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">SELECT</span> 列表</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">FROM</span> 表<span class="token number">1</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">NATURAL</span> <span class="token keyword">JOIN</span> 表<span class="token number">2</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>外连接 - 自然连接的特例：自然连接只有相同属性列的值相同才返回，外连接中若有一方的行的共同属性列没有找到与之匹配的行，则也保留该行，以 NULL 填充。左外连接、右外连接、全外连接</p><p>除（了解；t 代表元组、XY 代表属性）</p><p><img data-src="https://cdn.jsdelivr.net/gh/TV233/blogpic@main//img/8edcfe59689a429786dedd2502d43d3f.png" alt="img"></p><p>关系模型完整性约束：实体完整性约束（主键非空且不唯一）、参照完整性约束（主从表的外键主键一致）、用户自定义完整性约束</p><h2 id="三-sql语句"><a class="markdownIt-Anchor" href="#三-sql语句">#</a> 三、SQL 语句</h2><h3 id="31-sql概述"><a class="markdownIt-Anchor" href="#31-sql概述">#</a> 3.1 sql 概述</h3><p>数据定义语言（DDL）：创建修改删除数据库对象；create/drop/alter database/table/index</p><p>数据操纵语言（DML）：增删改数据；insert/update/delete</p><p>数据查询语言（DQL）：数据查询；</p><p>数据控制语言（DCL）：数据库对象访问控制；grant/deny/revoke</p><p>事物处理语言（TPL）：事物处理；begin transaction/commit/rollback</p><p>游标控制语言（CCL）：游标操作；declare cursor/fetch into/close cursor</p><h3 id="32-数据定义语句"><a class="markdownIt-Anchor" href="#32-数据定义语句">#</a> 3.2 数据定义语句</h3><h4 id="数据库"><a class="markdownIt-Anchor" href="#数据库">#</a> 数据库</h4><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> CourseDB<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">ALTER</span> <span class="token keyword">DATABASE</span> CourseDB <span class="token keyword">RENAME</span> <span class="token keyword">TO</span> CourseManageDB<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">DROP</span> <span class="token keyword">DATABASE</span> CourseManageDB；</pre></td></tr></table></figure><h4 id="数据库表"><a class="markdownIt-Anchor" href="#数据库表">#</a> 数据库表</h4><p>格式：列名 + 数据类型 + 列完整性约束</p><p>列完整行约束</p><p>PRIMARY KEY—— 单列主键</p><p>NOT NULL—— 非空值</p><p>NULL—— 空值</p><p>UNIQUE—— 值唯一</p><p>CHECK—— 有效性检查</p><p>DEFAULT—— 缺省值</p><p>表约束：可定义复合主键、代理键、外键，可以命名约束</p><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">CREATE</span>  <span class="token keyword">TABLE</span>  Student</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">(</span>StudentID      <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">)</span>    <span class="token keyword">PRIMARY</span>  <span class="token keyword">KEY</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre> StudentName    <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>	<span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">UNIQUE</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre> StudentGender  <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>     <span class="token boolean">NULL</span>     <span class="token keyword">CHECK</span><span class="token punctuation">(</span>StudentGender <span class="token operator">IN</span><span class="token punctuation">(</span><span class="token string">'男'</span><span class="token punctuation">,</span><span class="token string">'女'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre> BirthDay       <span class="token keyword">date</span>        <span class="token boolean">NULL</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre> Major          <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span> <span class="token boolean">NULL</span>     <span class="token keyword">DEFAULT</span> <span class="token string">'本科生'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre> StudentPhone	<span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span>    <span class="token boolean">NULL</span></pre></td></tr><tr><td data-num="8"></td><td><pre> <span class="token comment">-- 或者</span></pre></td></tr><tr><td data-num="9"></td><td><pre> <span class="token keyword">CONSTRAINT</span> Student_PK <span class="token keyword">PRIMARY</span> <span class="token keyword">Key</span><span class="token punctuation">(</span>StudentID<span class="token punctuation">,</span>StudentName<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre> </pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> STUDENT <span class="token keyword">ADD</span> <span class="token operator">&lt;</span><span class="token punctuation">.</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token punctuation">.</span><span class="token operator">></span><span class="token punctuation">[</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> STUDENT <span class="token keyword">DROP</span> <span class="token keyword">COLUMN</span><span class="token operator">&lt;</span><span class="token punctuation">.</span><span class="token operator">></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> STUDENT <span class="token keyword">DROP</span> <span class="token keyword">CONSTRAINT</span><span class="token operator">&lt;</span><span class="token punctuation">.</span><span class="token operator">></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> STUDENT <span class="token keyword">RENAME</span> <span class="token keyword">TO</span><span class="token operator">&lt;></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> STUDENT <span class="token keyword">RENAME</span> <span class="token operator">&lt;></span> <span class="token keyword">TO</span> <span class="token operator">&lt;></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> STUDENT <span class="token keyword">ALTER</span> <span class="token keyword">COLUMN</span><span class="token operator">&lt;></span> <span class="token keyword">TYPE</span><span class="token operator">&lt;></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre> </pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token operator">&lt;></span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>表约束定义代理键：有时为了方便数据处理，可以使用代理键去替代复合主键</p><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">CREATE</span>  <span class="token keyword">TABLE</span>  <span class="token keyword">Plan</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">(</span> CoursePlanID	<span class="token keyword">serial</span>		    <span class="token operator">NOT</span>  <span class="token boolean">NULL</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  CourseID  	<span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>  		<span class="token operator">NOT</span>  <span class="token boolean">NULL</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  TeacherID  	<span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>  		<span class="token operator">NOT</span>  <span class="token boolean">NULL</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  CourseRoom  	<span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  CourseTime  	<span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  Note  		<span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token keyword">CONSTRAINT</span>	CoursePlan_PK	<span class="token keyword">PRIMARY</span> <span class="token keyword">Key</span><span class="token punctuation">(</span>CoursePlanID<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>表约束定义外键</p><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">CREATE</span>  <span class="token keyword">TABLE</span>  Register</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">(</span> CourseRegID  	<span class="token keyword">serial</span>	    <span class="token operator">NOT</span>  <span class="token boolean">NULL</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  CoursePlanID  <span class="token keyword">Int</span>  		<span class="token operator">NOT</span>  <span class="token boolean">NULL</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  StudentID  	<span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  Note  		<span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token keyword">CONSTRAINT</span>	CourseRegID_PK	<span class="token keyword">PRIMARY</span> <span class="token keyword">Key</span><span class="token punctuation">(</span>CourseRegID<span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token keyword">CONSTRAINT</span>	CoursePlanID_FK	<span class="token keyword">FOREIGN</span> <span class="token keyword">Key</span><span class="token punctuation">(</span>CoursePlanID<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre>	<span class="token keyword">REFERENCES</span>  <span class="token keyword">Plan</span><span class="token punctuation">(</span>CoursePlanID<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">ON</span> <span class="token keyword">DELETE</span> <span class="token keyword">CASCADE</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token keyword">CONSTRAINT</span>	StudentID_FK	<span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span><span class="token punctuation">(</span>StudentID<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre>	<span class="token keyword">REFERENCES</span>  Student<span class="token punctuation">(</span>StudentID<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token keyword">ON</span> <span class="token keyword">DELETE</span> <span class="token keyword">CASCADE</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h4 id="数据库索引"><a class="markdownIt-Anchor" href="#数据库索引">#</a> 数据库索引</h4><p>索引（index）：将关系表按照指定列的取值顺序组织元组数据的数据结构，加快查询，占用额外存储空间、开销较大</p><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">CREATE</span> <span class="token keyword">INDEX</span> Birthday_Idx <span class="token keyword">ON</span>  STUDENT<span class="token punctuation">(</span>Birthday<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">ALTER</span> <span class="token keyword">INDEX</span> Birthday_Idx <span class="token keyword">RENAME</span> <span class="token keyword">TO</span> Bday_Idx<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">DROP</span> <span class="token keyword">INDEX</span> bday_idx<span class="token punctuation">;</span></pre></td></tr></table></figure><h3 id="33-数据操纵语句"><a class="markdownIt-Anchor" href="#33-数据操纵语句">#</a> 3.3 数据操纵语句</h3><h4 id="数据插入"><a class="markdownIt-Anchor" href="#数据插入">#</a> 数据插入</h4><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> Student <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">'2017220101105'</span><span class="token punctuation">,</span><span class="token string">'柳因'</span><span class="token punctuation">,</span><span class="token string">'女'</span><span class="token punctuation">,</span><span class="token string">'1999-04-23'</span><span class="token punctuation">,</span><span class="token string">'软件工程'</span><span class="token punctuation">,</span> <span class="token string">'liuyin@163.com'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h4 id="数据修改"><a class="markdownIt-Anchor" href="#数据修改">#</a> 数据修改</h4><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">UPDATE</span>  Student</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">SET</span>  Email<span class="token operator">=</span><span class="token string">'zhaodong@163.com'</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">WHERE</span>   StudentName<span class="token operator">=</span><span class="token string">'赵东'</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h4 id="数据删除"><a class="markdownIt-Anchor" href="#数据删除">#</a> 数据删除</h4><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">DELETE</span> </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">FROM</span>  STUDENT</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">WHERE</span>   StudentName<span class="token operator">=</span><span class="token string">'张亮'</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h3 id="34-数据查询语句"><a class="markdownIt-Anchor" href="#34-数据查询语句">#</a> 3.4 数据查询语句</h3><h4 id="单表查询"><a class="markdownIt-Anchor" href="#单表查询">#</a> 单表查询</h4><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">-- 通用结构</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">SELECT</span>  <span class="token punctuation">[</span><span class="token keyword">ALL</span><span class="token operator">|</span><span class="token keyword">DISTINCT</span><span class="token punctuation">]</span>  <span class="token operator">&lt;</span>目标列<span class="token operator">></span><span class="token punctuation">[</span>，<span class="token operator">&lt;</span>目标列<span class="token operator">></span>…<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">[</span> <span class="token keyword">INTO</span> <span class="token operator">&lt;</span>新表<span class="token operator">></span> <span class="token punctuation">]</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">FROM</span>  <span class="token operator">&lt;</span>表名<span class="token operator">|</span>视图名<span class="token operator">></span><span class="token punctuation">[</span>，<span class="token operator">&lt;</span>表名<span class="token operator">|</span>视图名<span class="token operator">></span>…<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">[</span> <span class="token keyword">WHERE</span>  <span class="token operator">&lt;</span>条件表达式<span class="token operator">></span> <span class="token punctuation">]</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">[</span> <span class="token keyword">GROUP</span> <span class="token keyword">BY</span>  <span class="token operator">&lt;</span>列名<span class="token operator">></span> <span class="token punctuation">[</span><span class="token keyword">HAVING</span> <span class="token operator">&lt;</span>条件表达式<span class="token operator">></span> <span class="token punctuation">]</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">[</span> <span class="token keyword">ORDER</span> <span class="token keyword">BY</span>  <span class="token operator">&lt;</span>列名<span class="token operator">></span> <span class="token punctuation">[</span> <span class="token keyword">ASC</span> <span class="token operator">|</span> <span class="token keyword">DESC</span> <span class="token punctuation">]</span> <span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token comment">-- BETWEEN AND 限制列值范围</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">SELECT</span>  <span class="token operator">*</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token keyword">FROM</span>  STUDENT</pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token keyword">WHERE</span> BirthDay <span class="token operator">BETWEEN</span> ‘<span class="token number">2000</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span>’ <span class="token operator">AND</span> ‘<span class="token number">2000</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">30</span>’<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token comment">-- LIKE/NOT LIKE 通配符 '_' 代表一个字符 '%' 代表一个或多个字符 </span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token keyword">SELECT</span>  <span class="token operator">*</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token keyword">FROM</span>  STUDENT</pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token keyword">WHERE</span>  Email  <span class="token operator">LIKE</span>  ’<span class="token operator">%</span><span class="token variable">@163.com</span>’<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token comment">-- AND\OR\NOT 逻辑运算符</span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token keyword">SELECT</span>  StudentID<span class="token punctuation">,</span> StudentName<span class="token punctuation">,</span> StudentGender<span class="token punctuation">,</span> Major</pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token keyword">FROM</span>  STUDENT</pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token keyword">WHERE</span>  Major<span class="token operator">=</span>’软件工程’  <span class="token operator">AND</span>  StudentGender<span class="token operator">=</span>’男’<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token comment">-- IN 限定范围</span></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token keyword">SELECT</span>  StudentID<span class="token punctuation">,</span> StudentName<span class="token punctuation">,</span> StudentGender<span class="token punctuation">,</span> Major</pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token keyword">FROM</span>  STUDENT</pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token keyword">WHERE</span>  Major <span class="token operator">IN</span>  <span class="token punctuation">(</span><span class="token string">'计算机应用'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="28"></td><td><pre></pre></td></tr><tr><td data-num="29"></td><td><pre><span class="token comment">-- ORDER BY &lt;> ASC/DESC 默认升序 ASC</span></pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token comment">-- 多个列排序时，写在前面排序的基础上满足后面的</span></pre></td></tr><tr><td data-num="31"></td><td><pre><span class="token keyword">SELECT</span>  <span class="token operator">*</span></pre></td></tr><tr><td data-num="32"></td><td><pre><span class="token keyword">FROM</span>  STUDENT</pre></td></tr><tr><td data-num="33"></td><td><pre><span class="token keyword">ORDER</span>  <span class="token keyword">BY</span>  Birthday <span class="token keyword">DESC</span> <span class="token punctuation">,</span>  StudentName  <span class="token keyword">ASC</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="34"></td><td><pre></pre></td></tr><tr><td data-num="35"></td><td><pre><span class="token comment">-- 内置函数</span></pre></td></tr><tr><td data-num="36"></td><td><pre><span class="token keyword">SELECT</span>  COUNT（<span class="token operator">*</span>） <span class="token keyword">AS</span>  学生人数</pre></td></tr><tr><td data-num="37"></td><td><pre><span class="token keyword">FROM</span>  Student<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="38"></td><td><pre><span class="token keyword">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token keyword">DISTINCT</span> Major<span class="token punctuation">)</span> <span class="token keyword">AS</span> 学生专业数</pre></td></tr><tr><td data-num="39"></td><td><pre><span class="token keyword">FROM</span> Student<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="40"></td><td><pre><span class="token keyword">SELECT</span>  Min（Birthday） <span class="token keyword">AS</span> 最大年龄，Max（Birthday） <span class="token keyword">AS</span> 最小年龄</pre></td></tr><tr><td data-num="41"></td><td><pre><span class="token keyword">FROM</span>  Student<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="42"></td><td><pre></pre></td></tr><tr><td data-num="43"></td><td><pre><span class="token comment">-- GROUP BY &lt;> HAVING </span></pre></td></tr><tr><td data-num="44"></td><td><pre><span class="token comment">-- 专业统计 STUDENT 表中专业男生人数，但限定只显示人数大于 2 的人数</span></pre></td></tr><tr><td data-num="45"></td><td><pre><span class="token keyword">SELECT</span>  Major  <span class="token keyword">AS</span> 专业<span class="token punctuation">,</span>  COUNT（StudentID） <span class="token keyword">AS</span> 学生人数</pre></td></tr><tr><td data-num="46"></td><td><pre><span class="token keyword">FROM</span>  Student</pre></td></tr><tr><td data-num="47"></td><td><pre><span class="token keyword">WHERE</span>  StudentGender<span class="token operator">=</span>’男’</pre></td></tr><tr><td data-num="48"></td><td><pre><span class="token keyword">GROUP</span>  <span class="token keyword">BY</span>  Major</pre></td></tr><tr><td data-num="49"></td><td><pre><span class="token keyword">HAVING</span>  <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token number">2</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h4 id="多表关联查询"><a class="markdownIt-Anchor" href="#多表关联查询">#</a> 多表关联查询</h4><p>子查询</p><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">SELECT</span>  TeacherID<span class="token punctuation">,</span> TeacherName<span class="token punctuation">,</span> TeacherTitle</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">FROM</span>  Teacher</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">WHERE</span>  CollegeID  <span class="token operator">IN</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token punctuation">(</span><span class="token keyword">SELECT</span>  CollegeID  </pre></td></tr><tr><td data-num="5"></td><td><pre>     <span class="token keyword">FROM</span>  College</pre></td></tr><tr><td data-num="6"></td><td><pre>     <span class="token keyword">WHERE</span>  CollegeName<span class="token operator">=</span><span class="token string">'计算机学院'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>连接查询</p><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">SELECT</span>  B<span class="token punctuation">.</span>CollegeName <span class="token keyword">AS</span> 学院名称<span class="token punctuation">,</span>  A<span class="token punctuation">.</span>TeacherID  <span class="token keyword">AS</span> 编号<span class="token punctuation">,</span> A<span class="token punctuation">.</span>TeacherName  <span class="token keyword">AS</span> 姓名<span class="token punctuation">,</span>  A<span class="token punctuation">.</span>TeacherGender  <span class="token keyword">AS</span> 性别<span class="token punctuation">,</span>  A<span class="token punctuation">.</span> TeacherTitle  <span class="token keyword">AS</span> 职称</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">FROM</span>  Teacher  <span class="token keyword">AS</span>  A，College  <span class="token keyword">AS</span>  B</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">WHERE</span>  A<span class="token punctuation">.</span>CollegeID<span class="token operator">=</span>B<span class="token punctuation">.</span>CollegeID </pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">ORDER</span>  <span class="token keyword">BY</span>  B<span class="token punctuation">.</span>CollegeName<span class="token punctuation">,</span> A<span class="token punctuation">.</span>TeacherID<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment">-- JOIN ON 内连接</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">SELECT</span>  B<span class="token punctuation">.</span>CollegeName <span class="token keyword">AS</span> 学院名称<span class="token punctuation">,</span>  A<span class="token punctuation">.</span>TeacherID  <span class="token keyword">AS</span> 编号<span class="token punctuation">,</span> A<span class="token punctuation">.</span>TeacherName  <span class="token keyword">AS</span> 姓名<span class="token punctuation">,</span>  A<span class="token punctuation">.</span>TeacherGender  <span class="token keyword">AS</span> 性别<span class="token punctuation">,</span>  A<span class="token punctuation">.</span> TeacherTitle  <span class="token keyword">AS</span> 职称</pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">FROM</span>  TEACHER  <span class="token keyword">AS</span>  A  <span class="token keyword">JOIN</span>  COLLEGE  <span class="token keyword">AS</span>  B</pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">ON</span>  A<span class="token punctuation">.</span>CollegeID<span class="token operator">=</span>B<span class="token punctuation">.</span>CollegeID </pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">ORDER</span>  <span class="token keyword">BY</span>  B<span class="token punctuation">.</span>CollegeName<span class="token punctuation">,</span> A<span class="token punctuation">.</span>TeacherID<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token comment">-- LEFT JOIN/RIGHT JOIN/FULL JOIN 外连接</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token keyword">SELECT</span> C<span class="token punctuation">.</span>CourseName <span class="token keyword">AS</span> 课程名称<span class="token punctuation">,</span> T<span class="token punctuation">.</span>TeacherName <span class="token keyword">AS</span> 教师<span class="token punctuation">,</span> </pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token function">COUNT</span>  <span class="token punctuation">(</span>R<span class="token punctuation">.</span>CoursePlanID<span class="token punctuation">)</span>  <span class="token keyword">AS</span> 选课人数</pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token keyword">FROM</span>  COURSE  <span class="token keyword">AS</span>  C  <span class="token keyword">JOIN</span>  <span class="token keyword">PLAN</span>  <span class="token keyword">AS</span>  P  </pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token keyword">ON</span>  C<span class="token punctuation">.</span>CourseID<span class="token operator">=</span>P<span class="token punctuation">.</span>CourseID </pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token keyword">JOIN</span>  TEACHER  <span class="token keyword">AS</span>  T  <span class="token keyword">ON</span>  P<span class="token punctuation">.</span>TeacherID<span class="token operator">=</span>T<span class="token punctuation">.</span>TeacherID</pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token keyword">LEFT</span>  <span class="token keyword">JOIN</span>  REGISTER  <span class="token keyword">AS</span>  R  <span class="token keyword">ON</span>  P<span class="token punctuation">.</span>CoursePlanID<span class="token operator">=</span>R<span class="token punctuation">.</span>CoursePlanID</pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token keyword">GROUP</span>  <span class="token keyword">BY</span> C<span class="token punctuation">.</span>CourseName<span class="token punctuation">,</span> T<span class="token punctuation">.</span>TeacherName<span class="token punctuation">;</span></pre></td></tr></table></figure><h2 id="四-数据库设计"><a class="markdownIt-Anchor" href="#四-数据库设计">#</a> 四、数据库设计</h2><h3 id="41-概述"><a class="markdownIt-Anchor" href="#41-概述">#</a> 4.1 概述</h3><h4 id="数据库开发过程"><a class="markdownIt-Anchor" href="#数据库开发过程">#</a> 数据库开发过程</h4><h4 id="数据库结构模型设计-数据库结构模型"><a class="markdownIt-Anchor" href="#数据库结构模型设计-数据库结构模型">#</a> 数据库结构模型设计 - 数据库结构模型</h4><table><thead><tr><th>概念数据模型 Conceptual Data Model (CDM)</th><th style="text-align:left">从用户角度所建模的系统数据对象及其关系，它帮助用户分析信息系统的数据结构关系。</th></tr></thead><tbody><tr><td>逻辑数据模型 Logic Data Mode (LDM)</td><td style="text-align:left">从系统分析员角度所建模的系统数据对象逻辑结构关系，它帮助开发人员分析信息系统的逻辑数据结构。</td></tr><tr><td>物理数据模型 Physical Data Model (PDM)</td><td style="text-align:left">从系统设计人员角度所建模的系统数据物理存储及结构关系，它针对设计者具体定义信息系统的数据库表结构。</td></tr></tbody></table><h3 id="42-e-r模型方法"><a class="markdownIt-Anchor" href="#42-e-r模型方法">#</a> 4.2 E-R 模型方法</h3><blockquote><p>“实体 - 联系模型”（Entity-Relationship Model）的简称。它是一种描述现实世界<strong>概念数据模型</strong>、<strong>逻辑数据模型</strong>的有效方法，基本元素有实体、属性、标识符和联系</p></blockquote><p>联系度数：联系中关联的实体数目</p><p>二元联系 - 基数：实体的实例与另一实体实例存在的数量对应关系，1/n，表示最大基数</p><p>实体参与关系：可选 / 强制，表示最小基数</p><p>实体继承联系：表示实体的相似性，有公共属性的是父实体，有特殊性的是子实体</p><p>强弱实体联系：弱实体的存在必须以强实体的存在为前提，这是一个相对的概念</p><p>扩展建模实例</p><h3 id="43-数据库建模设计"><a class="markdownIt-Anchor" href="#43-数据库建模设计">#</a> 4.3 数据库建模设计</h3><h4 id="概念数据模型"><a class="markdownIt-Anchor" href="#概念数据模型">#</a> 概念数据模型</h4><p>概念数据模型设计一般是采用 E-R 模型方法进行建模设计</p><p>扩展图书借阅 ER 模型</p><h4 id="cdmldmpdm模型转换设计"><a class="markdownIt-Anchor" href="#cdmldmpdm模型转换设计">#</a> CDM/LDM/PDM 模型转换设计</h4><p>当使用关系数据库时，物理数据模型（PDM）即为关系模型。CDM/LDM 到 PDM 的转换其实就是 E-R 模型到关系模型的转换。</p><p>CDM/LDM 转换</p><ol><li>LDM 将 CDM 的多对多实体联系转化为易于关系数据库实现的一对多实体联系</li><li>LDm 将 CDM 中的标识符依赖实体进一步细化，并区分主键标识符 &lt;pi&gt; 和外键标识符 &lt; fi &gt;，以便数据模型规范化处理</li></ol><p>E-R 模型到关系模型转换原理：</p><ol><li>将每一个实体转换成一个关系表，实体属性转换为关系表的列，实体标识符转换为关系表的主键或外键。</li><li>将实体之间的联系转化为关系表之间的参照完整性约束。</li></ol><p>弱实体转换为关系表</p><p>实体联系转换</p><p>实体继承联系转换</p><p>将父表中的主键放置到子表中，既做主键又做外键。</p><p>实体递归联系转换</p><p>系统数据库建模设计实例</p><h3 id="44-数据库规范化设计"><a class="markdownIt-Anchor" href="#44-数据库规范化设计">#</a> 4.4 数据库规范化设计</h3><p>通常在 LDM 时期进行规范化设计完善，减少冗余数据，设计合理依赖约束关系，降低维护数据完整性一致性的工作量，访问更高效</p><p>问题：一个表中存在多个主题的数据，且大量重复出现</p><h4 id="函数依赖理论"><a class="markdownIt-Anchor" href="#函数依赖理论">#</a> 函数依赖理论</h4><blockquote><p>在关系模式 R（U）中， U 为关系 R 的属性集合，X 和 Y 为属性 U 的子集。设 t，s 是关系 R 中的任意两个元组，如果 t [X] = s [X]，则 t [Y] = s [Y]。那么称 Y 函数依赖于 X，表示为 X→Y。此时函数依赖的左部称为决定因子，右部称为依赖函数。决定因子和依赖函数都是属性的集合。函数依赖反映属性或属性组之间相互依存、互相制约的关系，即关系表中属性之间的依赖关系。</p></blockquote><p>完全函数依赖</p><blockquote><p>设 X、Y 是某关系的不同属性集，如 X→Y，且不存在 X 中的子集 X’使 X’→Y，则 Y 称完全函数依赖，否则称 Y 部分函数依赖。</p></blockquote><p>对于关系 R（<u>X</u>, <u>Y</u>, N, O, P），其中（X，Y）为复合主键，若其它属性 N,O,P 都完整依赖于该复合主键，则称关系 R 为完全函数依赖。反之，其它属性 N,O,P 仅依赖于 X，或仅依赖于 Y，则称 R 为部分函数依赖。</p><p>函数传递依赖</p><p>对于关系 R（<u>X</u>, N, O, P），其中 X 为主键，若属性 N 依赖于 X，而 X 不依赖于 N，属性 O 依赖于 N。则属性 O 函数传递依赖于 X。</p><p>多值函数依赖</p><p>对于教学关系 R（课程，教师，课程参考书），一门课程可以有多个任课教师，也可以有多本参考书；每个任课教师可以任意选择他的参考书。该关系存在多值函数依赖。</p><h4 id="关系规范化范式"><a class="markdownIt-Anchor" href="#关系规范化范式">#</a> 关系规范化范式</h4><p>1NF：关系表中的属性不可再细分，否则该表不是关系表</p><p>2NF：1NF 基础上，消除关系中的属性部分函数依赖</p><blockquote><p>有一个关系（<u>A</u>,<u>B</u>,N,O,P）, 其复合主键为（A,B）, 那么 N,O,P 这三个非键属性都不存在只依赖 A 或只依赖 B 情况，则该关系满足第 2 范式，反之，不满足第 2 范式。</p></blockquote><p>3NF：2NF 基础上，切断属性传递函数依赖</p><blockquote><p>若有一个关系（A,N,O,P）, 主键为（A）, 那么非键属性 N,O 或 P 都不能由单个的 N,O 或 P 或它们的组合所确定。该关系满足第 3 范式。</p></blockquote><p>BCNF：所有函数依赖的决定因子都是候选键</p><p>4NF：BCNF 基础上，消除了多值函数依赖</p><p>实例：</p><h4 id="逆规范化处理"><a class="markdownIt-Anchor" href="#逆规范化处理">#</a> 逆规范化处理</h4><p>规范化过高也会导致数据库性能降低，因此要适当降低规范化范式约束，允许适当的数据冗余性，以获取数据访问性能。可以通过增加冗余列或派生列，多个表合并为一个表进行处理。</p><h2 id="五-数据库管理"><a class="markdownIt-Anchor" href="#五-数据库管理">#</a> 五、数据库管理</h2><h3 id="51-概述"><a class="markdownIt-Anchor" href="#51-概述">#</a> 5.1 概述</h3><p>包括性能索引查询并发管理、角色用户对象权限管理、安全备份恢复等。</p><p>pgadmin4-Postgresql 的数据库管理工具</p><h3 id="52-事务管理"><a class="markdownIt-Anchor" href="#52-事务管理">#</a> 5.2 事务管理</h3><p>防止业务处理单元的一组操作中某一步出现错误导致混乱，事务是 DBMS 执行的最小任务单元、故障恢复单元、并发控制任务单元</p><p>生命周期状态变迁图</p><p>事务 ACID 特性</p><ul><li>原子性（Atomicity）：事务所有操作在数据库中要么全部执行，要么全部不执行。</li><li>一致性（Consistency）：事务多次执行，其结果应一致。</li><li>隔离性（Isolation）：事务与事务之间隔离，并发执行透明。</li><li>持续性（Durability ）：事务完成后，数据改变必须是永久的。</li></ul><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">START</span> <span class="token keyword">TRANSACTION</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">INSERT</span>  <span class="token keyword">INTO</span> college<span class="token punctuation">(</span> collegeID<span class="token punctuation">,</span> collegename<span class="token punctuation">)</span><span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'004'</span><span class="token punctuation">,</span> <span class="token string">'外语学院'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">INSERT</span>  <span class="token keyword">INTO</span> college<span class="token punctuation">(</span> collegeID<span class="token punctuation">,</span> collegename<span class="token punctuation">)</span><span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'005'</span><span class="token punctuation">,</span> <span class="token string">'数学学院'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">INSERT</span>  <span class="token keyword">INTO</span> college<span class="token punctuation">(</span> collegeID<span class="token punctuation">,</span> collegename<span class="token punctuation">)</span><span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'006'</span><span class="token punctuation">,</span> <span class="token string">'临床医学院'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">COMMIT</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h3 id="53-并发控制"><a class="markdownIt-Anchor" href="#53-并发控制">#</a> 5.3 并发控制</h3><h4 id="事务调度"><a class="markdownIt-Anchor" href="#事务调度">#</a> 事务调度</h4><p>多个事务在 DBMS 同时运行可能对共享数据同时访问，需要加以约束控制按照恰当顺序访问，否则导致数据不一致和死锁。在 DBMS 中，为使并发事务调度实现的处理结果与串行化调度处理结果一致，事务管理器将并发执行事务的 SQL 数据操作请求提交给并发控制调度器。由并发控制调度器将各个事务的 SQL 数据操作请求按照一定顺序进行调度执行，并完成对数据库缓冲区的读写操作。</p><h5 id="数据不一致问题"><a class="markdownIt-Anchor" href="#数据不一致问题">#</a> 数据不一致问题</h5><p>丢失更新</p><p>T1、T2 两个事务并发执行，它们均对数据库共享数据 A 进行了非锁定资源的读写操作。当事务 T1 和 T2 均读入该共享数据 A 并修改，T2 提交的结果破坏了 T1 提交的结果，导致 T1 的修改被丢失。</p><p>不可重复读</p><p>幻象读</p><p>事务 T1 按一定条件从数据库中读取某些数据记录后，事务 T2 在其中插入了一些记录，当 T1 再次按相同条件读取数据时，发现多了一些记录。称为幻象读取。与不可重复读类似。</p><p>脏数据读取</p><h4 id="锁机制"><a class="markdownIt-Anchor" href="#锁机制">#</a> 锁机制</h4><p>事务对共享数据加锁访问，锁的粒度由数据库到表页面行</p><ul><li>排它锁定 (Lock-X)—— 锁定后，不允许其它事务对共享数据再加锁</li><li>共享锁定 (Lock-S)—— 锁定后，只允许其它事务对共享数据添加读取锁</li></ul><p>锁的相容性：排他锁与其他锁均不相容，共享锁之间相容</p><h5 id="加锁协议"><a class="markdownIt-Anchor" href="#加锁协议">#</a> 加锁协议</h5><p>一级加锁协议：对共享数据修改时执行排它锁定指令，直到该事务处理完成才解锁。只能避免丢失更新问题。</p><p>二级加锁协议：一级协议基础上，对共享数据读操作进行共享锁定指令，读完数据立刻释放共享锁。避免丢失更新问题，脏读。</p><p>三级加锁协议：一级协议基础之上，对共享数据读操作进行共享锁定指令，直到事务处理结束才释放。避免丢失更新、脏读、不可重复读问题。</p><h5 id="两阶段锁定协议"><a class="markdownIt-Anchor" href="#两阶段锁定协议">#</a> 两阶段锁定协议</h5><p>二阶段锁定协议可以保证可串行化调度</p><p>每个事务必须分两个阶段提出加锁和解锁申请:</p><ul><li>增长阶段，事务只能获得锁，但不能释放锁。</li><li>缩减阶段，事务只能释放锁，但不能获得新锁。</li></ul><h4 id="死锁"><a class="markdownIt-Anchor" href="#死锁">#</a> 死锁</h4><p>事务同时锁定两个及以上资源可能出现彼此不能继续执行的状态</p><h4 id="事务隔离"><a class="markdownIt-Anchor" href="#事务隔离">#</a> 事务隔离</h4><h3 id="54-安全管理"><a class="markdownIt-Anchor" href="#54-安全管理">#</a> 5.4 安全管理</h3><h4 id="存取安全模型"><a class="markdownIt-Anchor" href="#存取安全模型">#</a> 存取安全模型</h4><h4 id="系统安全模型"><a class="markdownIt-Anchor" href="#系统安全模型">#</a> 系统安全模型</h4><h4 id="用户管理"><a class="markdownIt-Anchor" href="#用户管理">#</a> 用户管理</h4><p>在 DBMS 中对每个用户进行管理</p><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">-- 创建用户</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">CREATE</span> <span class="token keyword">USER</span> <span class="token string">"USERA"</span> <span class="token keyword">WITH</span></pre></td></tr><tr><td data-num="3"></td><td><pre> LOGIN</pre></td></tr><tr><td data-num="4"></td><td><pre> INHERIT</pre></td></tr><tr><td data-num="5"></td><td><pre> NOSUPERUSER</pre></td></tr><tr><td data-num="6"></td><td><pre> NOCREATEDB</pre></td></tr><tr><td data-num="7"></td><td><pre> NOCREATEROLE</pre></td></tr><tr><td data-num="8"></td><td><pre> NOREPLICATION</pre></td></tr><tr><td data-num="9"></td><td><pre> CONNECTION <span class="token keyword">LIMIT</span> <span class="token operator">-</span><span class="token number">1</span></pre></td></tr><tr><td data-num="10"></td><td><pre> PASSWORD <span class="token string">'123456'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre> </pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token comment">-- 修改用户</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token keyword">ALTER</span> <span class="token keyword">USER</span> <span class="token string">"USERA"</span></pre></td></tr><tr><td data-num="14"></td><td><pre>  CONNECTION <span class="token keyword">LIMIT</span> <span class="token number">10</span></pre></td></tr><tr><td data-num="15"></td><td><pre>  PASSWORD <span class="token string">'GRES123'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token keyword">ALTER</span> <span class="token keyword">USER</span>  <span class="token operator">&lt;</span>用户名<span class="token operator">></span>  <span class="token punctuation">[</span> <span class="token punctuation">[</span> <span class="token keyword">WITH</span> <span class="token punctuation">]</span> <span class="token keyword">option</span> <span class="token punctuation">[</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">]</span> <span class="token punctuation">]</span><span class="token punctuation">;</span>              	<span class="token comment">-- 修改用户的属性</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token keyword">ALTER</span> <span class="token keyword">USER</span>  <span class="token operator">&lt;</span>用户名<span class="token operator">></span>  <span class="token keyword">RENAME</span> <span class="token keyword">TO</span> <span class="token operator">&lt;</span>新用户名<span class="token operator">></span><span class="token punctuation">;</span>                          <span class="token comment">-- 修改用户的名称</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token keyword">ALTER</span> <span class="token keyword">USER</span>  <span class="token operator">&lt;</span>用户名<span class="token operator">></span>  <span class="token keyword">SET</span> <span class="token operator">&lt;</span>参数项<span class="token operator">></span> &#123; <span class="token keyword">TO</span> <span class="token operator">|</span> <span class="token operator">=</span> &#125; &#123; <span class="token keyword">value</span> <span class="token operator">|</span> <span class="token keyword">DEFAULT</span> &#125;<span class="token punctuation">;</span>  <span class="token comment">-- 修改用户的参数值  </span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token keyword">ALTER</span> <span class="token keyword">USER</span>  <span class="token operator">&lt;</span>用户名<span class="token operator">></span>  RESET <span class="token operator">&lt;</span>参数项<span class="token operator">></span><span class="token punctuation">;</span>			                      <span class="token comment">-- 重置用户参数值</span></pre></td></tr><tr><td data-num="20"></td><td><pre></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token comment">-- 删除用户</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token keyword">DROP</span> <span class="token keyword">USER</span> <span class="token string">"USERA"</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h4 id="权限管理"><a class="markdownIt-Anchor" href="#权限管理">#</a> 权限管理</h4><p>DBA 对用户进行数据库系统 / 数据库对象访问操作 / 数据库对象定义操作的授予 / 收回 / 拒绝权限</p><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">GRANT</span>  <span class="token keyword">SELECT</span>  <span class="token keyword">ON</span>  Department  <span class="token keyword">TO</span>  userA<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">GRANT</span>  <span class="token keyword">SELECT</span>  <span class="token keyword">ON</span>  Employee    <span class="token keyword">TO</span>  userA<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">GRANT</span>  <span class="token keyword">SELECT</span>  <span class="token keyword">ON</span>  Project     <span class="token keyword">TO</span>  userA<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">GRANT</span>  <span class="token keyword">SELECT</span>  <span class="token keyword">ON</span>  Assignment  <span class="token keyword">TO</span>  userA<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">GRANT</span>  <span class="token operator">&lt;</span>权限名<span class="token operator">></span> <span class="token keyword">ON</span>  <span class="token operator">&lt;</span>对象名<span class="token operator">></span>  <span class="token keyword">TO</span> &#123;数据库用户名<span class="token operator">|</span>用户角色名&#125;；</pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">REVOKE</span>  <span class="token operator">&lt;</span>权限名<span class="token operator">></span> <span class="token keyword">ON</span>  <span class="token operator">&lt;</span>对象名<span class="token operator">></span>  <span class="token keyword">FROM</span> &#123;数据库用户名<span class="token operator">|</span>用户角色名&#125;；</pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">DENY</span>  <span class="token operator">&lt;</span>权限名<span class="token operator">></span> <span class="token keyword">ON</span>  <span class="token operator">&lt;</span>对象名<span class="token operator">></span> <span class="token keyword">TO</span> &#123;数据库用户名<span class="token operator">|</span>用户角色名&#125;；</pre></td></tr></table></figure><h4 id="角色管理"><a class="markdownIt-Anchor" href="#角色管理">#</a> 角色管理</h4><p>将一组相同权限的用户定义为角色</p><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">CREATE</span>  ROLE  <span class="token operator">&lt;</span>角色名<span class="token operator">></span> <span class="token punctuation">[</span> <span class="token punctuation">[</span> <span class="token keyword">WITH</span> <span class="token punctuation">]</span> <span class="token keyword">option</span> <span class="token punctuation">[</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">]</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> 	               <span class="token comment">-- 创建角色</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">ALTER</span>  ROLE  <span class="token operator">&lt;</span>角色名<span class="token operator">></span>  <span class="token punctuation">[</span> <span class="token punctuation">[</span> <span class="token keyword">WITH</span> <span class="token punctuation">]</span> <span class="token keyword">option</span> <span class="token punctuation">[</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">]</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> 	               <span class="token comment">-- 修改角色属性</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">ALTER</span>  ROLE  <span class="token operator">&lt;</span>角色名<span class="token operator">></span>  <span class="token keyword">RENAME</span> <span class="token keyword">TO</span> <span class="token operator">&lt;</span>新角色名<span class="token operator">></span><span class="token punctuation">;</span> 		                    <span class="token comment">-- 修改角色名称 </span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">ALTER</span>  ROLE  <span class="token operator">&lt;</span>角色名<span class="token operator">></span>  <span class="token keyword">SET</span> <span class="token operator">&lt;</span>参数项<span class="token operator">></span> &#123; <span class="token keyword">TO</span> <span class="token operator">|</span> <span class="token operator">=</span> &#125; &#123; <span class="token keyword">value</span> <span class="token operator">|</span> <span class="token keyword">DEFAULT</span> &#125;<span class="token punctuation">;</span>	 <span class="token comment">-- 修改角色参数值</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">ALTER</span>  ROLE  <span class="token operator">&lt;</span>角色名<span class="token operator">></span>  RESET <span class="token operator">&lt;</span>参数项<span class="token operator">></span><span class="token punctuation">;</span>	                    		 <span class="token comment">-- 复位角色参数值</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">DROP</span>  ROLE  <span class="token operator">&lt;</span>角色名<span class="token operator">></span><span class="token punctuation">;</span>					                           	   <span class="token comment">-- 删除指定角色</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">CREATE</span>  ROLE  <span class="token string">"Role_Manager"</span>  <span class="token keyword">WITH</span></pre></td></tr><tr><td data-num="9"></td><td><pre> LOGIN</pre></td></tr><tr><td data-num="10"></td><td><pre> NOSUPERUSER</pre></td></tr><tr><td data-num="11"></td><td><pre> NOCREATEDB</pre></td></tr><tr><td data-num="12"></td><td><pre> NOCREATEROLE</pre></td></tr><tr><td data-num="13"></td><td><pre> INHERIT</pre></td></tr><tr><td data-num="14"></td><td><pre> NOREPLICATION</pre></td></tr><tr><td data-num="15"></td><td><pre> CONNECTION <span class="token keyword">LIMIT</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token keyword">GRANT</span>  <span class="token keyword">SELECT</span><span class="token punctuation">,</span><span class="token keyword">INSERT</span><span class="token punctuation">,</span><span class="token keyword">UPDATE</span><span class="token punctuation">,</span><span class="token keyword">DELETE</span>  <span class="token keyword">ON</span>  Department  <span class="token keyword">TO</span>  <span class="token string">"Role_Manager"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token keyword">GRANT</span>  <span class="token keyword">SELECT</span><span class="token punctuation">,</span><span class="token keyword">INSERT</span><span class="token punctuation">,</span><span class="token keyword">UPDATE</span><span class="token punctuation">,</span><span class="token keyword">DELETE</span>  <span class="token keyword">ON</span>  Employee  <span class="token keyword">TO</span>  <span class="token string">"Role_Manager"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token keyword">GRANT</span>  <span class="token keyword">SELECT</span><span class="token punctuation">,</span><span class="token keyword">INSERT</span><span class="token punctuation">,</span><span class="token keyword">UPDATE</span><span class="token punctuation">,</span><span class="token keyword">DELETE</span>  <span class="token keyword">ON</span>  Project  <span class="token keyword">TO</span>  <span class="token string">"Role_Manager"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token keyword">GRANT</span>  <span class="token keyword">SELECT</span><span class="token punctuation">,</span><span class="token keyword">INSERT</span><span class="token punctuation">,</span><span class="token keyword">UPDATE</span><span class="token punctuation">,</span><span class="token keyword">DELETE</span>  <span class="token keyword">ON</span>  Assignment  <span class="token keyword">TO</span>  <span class="token string">"Role_Manager"</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>为用户赋予角色</p><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">CREATE</span> <span class="token keyword">USER</span>  <span class="token string">"StudentUser"</span>  <span class="token keyword">WITH</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  LOGIN</pre></td></tr><tr><td data-num="3"></td><td><pre>  CONNECTION <span class="token keyword">LIMIT</span> <span class="token operator">-</span><span class="token number">1</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token operator">IN</span> ROLE <span class="token string">"R_Student"</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  PASSWORD <span class="token string">'123456'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">CREATE</span> <span class="token keyword">USER</span>  <span class="token string">"TeacherUser"</span>  <span class="token keyword">WITH</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  LOGIN</pre></td></tr><tr><td data-num="8"></td><td><pre>  CONNECTION <span class="token keyword">LIMIT</span> <span class="token operator">-</span><span class="token number">1</span></pre></td></tr><tr><td data-num="9"></td><td><pre>  <span class="token operator">IN</span> ROLE <span class="token string">"R_Teacher"</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  PASSWORD <span class="token string">'123456'</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h3 id="55-数据库备份与恢复"><a class="markdownIt-Anchor" href="#55-数据库备份与恢复">#</a> 5.5 数据库备份与恢复</h3><p>数据库备份：对数据和状态（日志）进行副本复制</p><p>数据库恢复：从备份副本将数据库从错误状态恢复到某一正确状态</p><p>备份 SAMPLE 数据库到一个 G 磁盘的根目录文件 Sample.bak 中。</p><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">BACKUP</span> <span class="token keyword">DATABASE</span> SAMPLE   </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">TO</span> <span class="token keyword">DISK</span> <span class="token operator">=</span> ‘G:\Sample<span class="token punctuation">.</span>bak'<span class="token punctuation">;</span></pre></td></tr></table></figure><p>从存储备份文件中恢复 SAMPLE 数据库。</p><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">RESTORE</span> <span class="token keyword">DATABASE</span> SAMPLE</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">FROM</span> <span class="token keyword">DISK</span> <span class="token operator">=</span> ‘G:\Sample<span class="token punctuation">.</span>bak'<span class="token punctuation">;</span></pre></td></tr></table></figure><p>也可利用事务日志前滚或回滚方式进行数据库恢复</p><h2 id="六-数据库应用编程"><a class="markdownIt-Anchor" href="#六-数据库应用编程">#</a> 六、数据库应用编程</h2><h3 id="61-数据库连接技术jdbc"><a class="markdownIt-Anchor" href="#61-数据库连接技术jdbc">#</a> 6.1 数据库连接技术（JDBC）</h3><h4 id="概念"><a class="markdownIt-Anchor" href="#概念">#</a> 概念</h4><p><strong>JDBC</strong>（Java DataBase Connectivity，Java 数据库连接）技术的简称 ，是一种用于执行 SQL 语句的 Java API。它由一组用 Java 编程语言编写的类和接口组成。这个 API 由<strong> java.sql.* 包中</strong>的一些类和接口组成，它为数据库开发人员提供了一个标准的 API，使他们能够用纯 Java API 来编写数据库应用程序。使用 JDBC 访问数据库需要相应数据库的 JDBC 驱动程序</p><h4 id="分级"><a class="markdownIt-Anchor" href="#分级">#</a> 分级</h4><h4 id="jdbc访问数据库步骤"><a class="markdownIt-Anchor" href="#jdbc访问数据库步骤">#</a> JDBC 访问数据库步骤</h4><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 加载驱动</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"org.postgresql.Driver"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment">// 建立连接</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token class-name">String</span> <span class="token class-name">UrL</span> <span class="token operator">=</span> <span class="token string">"jdbc:postgresql://localhost:5432/testdb"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token class-name">String</span> username <span class="token operator">=</span> <span class="token string">"myuser"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token class-name">String</span> password <span class="token operator">=</span> <span class="token string">"sa"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token class-name">Connection</span> conn <span class="token operator">=</span> <span class="token class-name">DriverManager</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span>URL<span class="token punctuation">,</span>username<span class="token punctuation">,</span>password<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token comment">// 创建 Statement 对象</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token class-name">Statement</span> stmt <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">createStatement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token comment">// 执行 sql 语句</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">"INSERT INTO public.student (sid, sname, gender, birthday, major, phone)"</span> <span class="token operator">+</span> <span class="token string">" VALUES ('2017001', '张山', '男', '1998-10-10','软件工程','13602810001')"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>stmt<span class="token punctuation">.</span><span class="token function">executeUpdate</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>创建了 Statement 对象，就可以向 Statement 对象发送 SQL 语句。主要掌握两种执行 SQL 语句的方法：executeQuery ()、executeUpdate ()</p><ol><li>executeQuery ()：返回语句执行后的单个结果集的，所以通常用于 select 语句</li><li>executeUpdate () 返回值是一个整数，指示受影响的行数（可以用于 update、insert、delete 语句）</li></ol><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 保存结果集</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token class-name">Statement</span> stmt <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">createStatement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">"SELECT id, name, age FROM company"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token class-name">ResultSet</span> rs <span class="token operator">=</span> stmt<span class="token punctuation">.</span><span class="token function">executeQuery</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">while</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token comment">// 关闭连接</span></pre></td></tr><tr><td data-num="9"></td><td><pre>rs<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>stmt<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>conn<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token keyword">package</span> <span class="token namespace">testConnDB</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>sql<span class="token punctuation">.</span></span><span class="token class-name">Connection</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>sql<span class="token punctuation">.</span></span><span class="token class-name">DriverManager</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>sql<span class="token punctuation">.</span></span><span class="token class-name">PreparedStatement</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>sql<span class="token punctuation">.</span></span><span class="token class-name">ResultSet</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SQLinJava</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token class-name">Connection</span> conn <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token class-name">String</span> URL <span class="token operator">=</span> <span class="token string">"jdbc:postgresql://localhost:5432/testDB"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token class-name">String</span> userName <span class="token operator">=</span> <span class="token string">"myuser"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token class-name">String</span> passWord <span class="token operator">=</span> <span class="token string">"sa"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token class-name">String</span> sid<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">"14102"</span><span class="token punctuation">,</span><span class="token string">"14103"</span><span class="token punctuation">,</span><span class="token string">"14202"</span><span class="token punctuation">,</span><span class="token string">"14301"</span><span class="token punctuation">,</span><span class="token string">"14101"</span><span class="token punctuation">,</span><span class="token string">"14201"</span><span class="token punctuation">,</span><span class="token string">"14503"</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token class-name">String</span> cid<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">"1205"</span><span class="token punctuation">,</span><span class="token string">"1208"</span><span class="token punctuation">,</span><span class="token string">"1205"</span><span class="token punctuation">,</span><span class="token string">"1208"</span><span class="token punctuation">,</span><span class="token string">"1201"</span><span class="token punctuation">,</span><span class="token string">"1201"</span><span class="token punctuation">,</span><span class="token string">"1201"</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token keyword">int</span> score<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token number">90</span><span class="token punctuation">,</span><span class="token number">78</span><span class="token punctuation">,</span><span class="token number">89</span><span class="token punctuation">,</span><span class="token number">68</span><span class="token punctuation">,</span><span class="token number">86</span><span class="token punctuation">,</span><span class="token number">96</span><span class="token punctuation">,</span><span class="token number">83</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="29"></td><td><pre><span class="token keyword">try</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"org.postgresql.Driver"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="31"></td><td><pre>conn <span class="token operator">=</span> <span class="token class-name">DriverManager</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span>URL <span class="token punctuation">,</span> userName<span class="token punctuation">,</span> passWord <span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="32"></td><td><pre><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"成功连接数据库！ "</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="33"></td><td><pre><span class="token class-name">String</span> insertSql <span class="token operator">=</span> <span class="token string">"INSERT INTO stu_score(sid, cid, score) VALUES (?,?,?)"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="34"></td><td><pre><span class="token class-name">String</span> querySql <span class="token operator">=</span> <span class="token string">"select sid, cid, score from stu_score where score>=?"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="35"></td><td><pre><span class="token class-name">PreparedStatement</span> psInsert <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">prepareStatement</span><span class="token punctuation">(</span>insertSql<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 定义动态执行 SQL 语句对象</span></pre></td></tr><tr><td data-num="36"></td><td><pre><span class="token class-name">PreparedStatement</span> psQuery <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">prepareStatement</span><span class="token punctuation">(</span>querySql） <span class="token punctuation">;</span> <span class="token comment">// 定义动态执行 SQL 语句对象 113</span></pre></td></tr><tr><td data-num="37"></td><td><pre><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>sid<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="38"></td><td><pre><span class="token punctuation">&#123;</span>p</pre></td></tr><tr><td data-num="39"></td><td><pre>sInsert<span class="token punctuation">.</span><span class="token function">setString</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> sid<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="40"></td><td><pre>psInsert<span class="token punctuation">.</span><span class="token function">setString</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> cid<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="41"></td><td><pre>psInsert<span class="token punctuation">.</span><span class="token function">setInt</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> score<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="42"></td><td><pre>psInsert<span class="token punctuation">.</span><span class="token function">addBatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 添加批处理的记录</span></pre></td></tr><tr><td data-num="43"></td><td><pre><span class="token punctuation">&#125;</span>p</pre></td></tr><tr><td data-num="44"></td><td><pre>sInsert<span class="token punctuation">.</span><span class="token function">executeBatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 批处理执行多条数据记录</span></pre></td></tr><tr><td data-num="45"></td><td><pre>psQuery<span class="token punctuation">.</span><span class="token function">setInt</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="46"></td><td><pre><span class="token class-name">ResultSet</span> rs <span class="token operator">=</span> psQuery<span class="token punctuation">.</span><span class="token function">executeQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="47"></td><td><pre><span class="token keyword">while</span> <span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// 判断是否还有下一个数据</span></pre></td></tr><tr><td data-num="48"></td><td><pre><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"sid"</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" "</span> <span class="token operator">+</span> rs<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"cid"</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" "</span> <span class="token operator">+</span> rs<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token string">"score"</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="49"></td><td><pre><span class="token punctuation">&#125;</span> p</pre></td></tr><tr><td data-num="50"></td><td><pre>sQuery<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="51"></td><td><pre>psInsert<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="52"></td><td><pre>conn<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="53"></td><td><pre><span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span> <span class="token class-name">Exception</span> e <span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="54"></td><td><pre><span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span> e<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">": "</span><span class="token operator">+</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="55"></td><td><pre><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="56"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="57"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="58"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id="62-数据库存储过程"><a class="markdownIt-Anchor" href="#62-数据库存储过程">#</a> 6.2 数据库存储过程</h3><p>存储过程，一种数据库对象，由一组能完成特定功能的 SQL 语句集构成，编译后存储在数据库服务端接受调用。能够减少网络通信量加快执行速度，不过开发调试复杂可移植性差。</p><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">create</span> <span class="token operator">or</span> <span class="token keyword">replace</span> <span class="token keyword">function</span> price <span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">return</span> <span class="token keyword">integer</span> <span class="token keyword">as</span> $price$</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">declare</span></pre></td></tr><tr><td data-num="4"></td><td><pre>	price <span class="token keyword">integer</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">begin</span></pre></td></tr><tr><td data-num="6"></td><td><pre>	<span class="token keyword">select</span> price <span class="token keyword">into</span> price <span class="token keyword">from</span> goods_price</pre></td></tr><tr><td data-num="7"></td><td><pre>	<span class="token keyword">where</span> good_id <span class="token operator">=</span> <span class="token number">123</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>	<span class="token keyword">return</span> price<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">end</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>$price$ <span class="token keyword">language</span> plpgsql<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token keyword">CREATE</span> <span class="token punctuation">[</span> <span class="token operator">OR</span> <span class="token keyword">REPLACE</span> <span class="token punctuation">]</span> <span class="token keyword">FUNCTION</span><span class="token operator">/</span><span class="token keyword">PROCEDURE</span>  name</pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token punctuation">(</span> <span class="token punctuation">[</span> <span class="token punctuation">[</span> argmode <span class="token punctuation">]</span> <span class="token punctuation">[</span> argname <span class="token punctuation">]</span> argtype <span class="token punctuation">[</span> &#123; <span class="token keyword">DEFAULT</span> <span class="token operator">|</span> <span class="token operator">=</span> &#125; default_expr <span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span> <span class="token punctuation">]</span> <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token punctuation">[</span> <span class="token keyword">RETURNS</span> retype <span class="token operator">|</span> <span class="token keyword">RETURNS</span> <span class="token keyword">TABLE</span> <span class="token punctuation">(</span> column_name  column_type <span class="token punctuation">[</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span> <span class="token punctuation">)</span> <span class="token punctuation">]</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token keyword">AS</span> $$         <span class="token comment">//$$ 用于声明存储过程的实际代码的开始</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token keyword">DECLARE</span></pre></td></tr><tr><td data-num="19"></td><td><pre>        <span class="token comment">-- 声明段</span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token keyword">BEGIN</span></pre></td></tr><tr><td data-num="21"></td><td><pre>        <span class="token comment">-- 函数体语句</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token keyword">END</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>$$ <span class="token keyword">LANGUAGE</span> lang_name<span class="token punctuation">;</span>  <span class="token comment">//$$ 表明代码的结束，LANGUAGE 后面指明所用的编程语言</span></pre></td></tr><tr><td data-num="24"></td><td><pre></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token comment">-- 创建一个名为 countRecords () 的存储过程统计 STUDENT 表的记录数。</span></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token keyword">CREATE</span> <span class="token operator">OR</span> <span class="token keyword">REPLACE</span> <span class="token keyword">FUNCTION</span> countRecords <span class="token punctuation">(</span><span class="token punctuation">)</span>  </pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token keyword">RETURNS</span> <span class="token keyword">integer</span> <span class="token keyword">AS</span> $count$  </pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token keyword">declare</span>  </pre></td></tr><tr><td data-num="29"></td><td><pre>    count <span class="token keyword">integer</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token keyword">BEGIN</span>  </pre></td></tr><tr><td data-num="31"></td><td><pre>   <span class="token keyword">SELECT</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">into</span> count <span class="token keyword">FROM</span> STUDENT<span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="32"></td><td><pre>   <span class="token keyword">RETURN</span> count<span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="33"></td><td><pre><span class="token keyword">END</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="34"></td><td><pre>$count$ <span class="token keyword">LANGUAGE</span> plpgsql<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="35"></td><td><pre></pre></td></tr><tr><td data-num="36"></td><td><pre><span class="token comment">-- 执行存储过程</span></pre></td></tr><tr><td data-num="37"></td><td><pre><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> countRecords<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="38"></td><td><pre></pre></td></tr><tr><td data-num="39"></td><td><pre><span class="token comment">-- 存储过程调用其他存储过程:select  into 自定义变量  from 存储过程名（参数）；</span></pre></td></tr><tr><td data-num="40"></td><td><pre><span class="token keyword">CREATE</span> <span class="token operator">OR</span> <span class="token keyword">REPLACE</span> <span class="token keyword">FUNCTION</span> testExec<span class="token punctuation">(</span><span class="token punctuation">)</span>  </pre></td></tr><tr><td data-num="41"></td><td><pre><span class="token keyword">returns</span> <span class="token keyword">integer</span> <span class="token keyword">AS</span> $$ </pre></td></tr><tr><td data-num="42"></td><td><pre><span class="token keyword">declare</span></pre></td></tr><tr><td data-num="43"></td><td><pre>   rec <span class="token keyword">integer</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="44"></td><td><pre><span class="token keyword">BEGIN</span>  </pre></td></tr><tr><td data-num="45"></td><td><pre>   <span class="token keyword">select</span>  <span class="token keyword">into</span> rec countRecords<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="46"></td><td><pre>     <span class="token comment">// 如果不关心 countRecords () 的返回值，则可用 PERFORM countRecords () 代替；</span></pre></td></tr><tr><td data-num="47"></td><td><pre>   <span class="token keyword">return</span>  rec<span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="48"></td><td><pre><span class="token keyword">END</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="49"></td><td><pre>$$ <span class="token keyword">LANGUAGE</span> plpgsql<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="50"></td><td><pre></pre></td></tr><tr><td data-num="51"></td><td><pre><span class="token comment">-- 删除存储过程</span></pre></td></tr><tr><td data-num="52"></td><td><pre><span class="token keyword">DROP</span> <span class="token keyword">FUNCTION</span> <span class="token punctuation">[</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> <span class="token punctuation">]</span> name <span class="token punctuation">(</span> <span class="token punctuation">[</span> <span class="token punctuation">[</span> argmode <span class="token punctuation">]</span> <span class="token punctuation">[</span> argname <span class="token punctuation">]</span> argtype <span class="token punctuation">[</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span> <span class="token punctuation">]</span> <span class="token punctuation">)</span> <span class="token punctuation">[</span> <span class="token keyword">CASCADE</span> <span class="token operator">|</span> <span class="token keyword">RESTRICT</span> <span class="token punctuation">]</span></pre></td></tr><tr><td data-num="53"></td><td><pre></pre></td></tr><tr><td data-num="54"></td><td><pre><span class="token keyword">DROP</span> <span class="token keyword">FUNCTION</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> testExec<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="55"></td><td><pre><span class="token keyword">drop</span> <span class="token keyword">function</span> <span class="token keyword">if</span> <span class="token keyword">exists</span> price<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="56"></td><td><pre></pre></td></tr><tr><td data-num="57"></td><td><pre>客户银行余额信息表accounts；</pre></td></tr><tr><td data-num="58"></td><td><pre><span class="token keyword">drop</span> <span class="token keyword">table</span> <span class="token keyword">if</span> <span class="token keyword">exists</span> accounts<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="59"></td><td><pre><span class="token keyword">create</span> <span class="token keyword">table</span> accounts <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="60"></td><td><pre>    id <span class="token keyword">SERIAL</span><span class="token punctuation">,</span>                       		<span class="token comment">-- 客户 ID 号</span></pre></td></tr><tr><td data-num="61"></td><td><pre>    username <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>	<span class="token comment">-- 客户姓名</span></pre></td></tr><tr><td data-num="62"></td><td><pre>    balance <span class="token keyword">dec</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>	<span class="token comment">-- 账户余额</span></pre></td></tr><tr><td data-num="63"></td><td><pre>    <span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="64"></td><td><pre><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="65"></td><td><pre></pre></td></tr><tr><td data-num="66"></td><td><pre>客户转账信息表translists；</pre></td></tr><tr><td data-num="67"></td><td><pre><span class="token keyword">drop</span> <span class="token keyword">table</span> <span class="token keyword">if</span> <span class="token keyword">exists</span> translists<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="68"></td><td><pre><span class="token keyword">create</span> <span class="token keyword">table</span> translists <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="69"></td><td><pre>id <span class="token keyword">SERIAL</span> <span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">,</span>		<span class="token comment">-- 转账记录 ID</span></pre></td></tr><tr><td data-num="70"></td><td><pre>sendid <span class="token keyword">int</span><span class="token punctuation">,</span>				<span class="token comment">-- 转出客户的 ID</span></pre></td></tr><tr><td data-num="71"></td><td><pre>sendname <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>	<span class="token comment">-- 转出客户的姓名</span></pre></td></tr><tr><td data-num="72"></td><td><pre>recid <span class="token keyword">int</span><span class="token punctuation">,</span>				<span class="token comment">-- 转入客户的 ID</span></pre></td></tr><tr><td data-num="73"></td><td><pre>recname <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>	<span class="token comment">-- 转入客户的姓名</span></pre></td></tr><tr><td data-num="74"></td><td><pre>transdate <span class="token keyword">timestamp</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>		<span class="token comment">-- 转账时间</span></pre></td></tr><tr><td data-num="75"></td><td><pre>transamount <span class="token keyword">dec</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span>	<span class="token comment">-- 转账金额</span></pre></td></tr><tr><td data-num="76"></td><td><pre><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="77"></td><td><pre></pre></td></tr><tr><td data-num="78"></td><td><pre>使用存储过程实现银行转账，客户银行余额信息存在accounts表中，转账记录信息存在translists表中；银行转账包括三个主要操作：</pre></td></tr><tr><td data-num="79"></td><td><pre>首先检查转出账户的余额是否充足，如果大于转出金额，将客户的余额减去转账金额；</pre></td></tr><tr><td data-num="80"></td><td><pre>然后给转入账户的余额加上转账金额；</pre></td></tr><tr><td data-num="81"></td><td><pre>最后记录转账信息，以供后期备查。</pre></td></tr><tr><td data-num="82"></td><td><pre><span class="token keyword">create</span> <span class="token operator">or</span> <span class="token keyword">replace</span> <span class="token keyword">procedure</span> send <span class="token punctuation">(</span>money <span class="token keyword">integer</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="83"></td><td><pre><span class="token keyword">as</span> $$</pre></td></tr><tr><td data-num="84"></td><td><pre><span class="token keyword">declare</span> </pre></td></tr><tr><td data-num="85"></td><td><pre>leftOfSender <span class="token keyword">integer</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="86"></td><td><pre>leftOfReceider <span class="token keyword">integer</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="87"></td><td><pre>log <span class="token keyword">text</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="88"></td><td><pre><span class="token keyword">begin</span></pre></td></tr><tr><td data-num="89"></td><td><pre><span class="token keyword">if</span> money <span class="token operator">&lt;</span> <span class="token keyword">select</span> balace <span class="token keyword">from</span> accounts <span class="token keyword">where</span> id</pre></td></tr><tr><td data-num="90"></td><td><pre></pre></td></tr><tr><td data-num="91"></td><td><pre></pre></td></tr><tr><td data-num="92"></td><td><pre></pre></td></tr><tr><td data-num="93"></td><td><pre><span class="token keyword">CREATE</span> <span class="token operator">OR</span> <span class="token keyword">REPLACE</span> <span class="token keyword">FUNCTION</span> score_audit<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">RETURNS</span> <span class="token keyword">TRIGGER</span> <span class="token keyword">AS</span> $score audit$</pre></td></tr><tr><td data-num="94"></td><td><pre>	<span class="token keyword">BEGIN</span></pre></td></tr><tr><td data-num="95"></td><td><pre>		<span class="token keyword">IF</span> <span class="token punctuation">(</span>TG OP <span class="token operator">=</span> <span class="token string">'DELETE'</span><span class="token punctuation">)</span> <span class="token keyword">THEN</span></pre></td></tr><tr><td data-num="96"></td><td><pre>			<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> audit_score <span class="token keyword">SELECT</span> <span class="token keyword">user</span>，old<span class="token punctuation">.</span>sid， old<span class="token punctuation">.</span>cid<span class="token punctuation">,</span> <span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> OLD<span class="token punctuation">.</span>score <span class="token punctuation">;</span></pre></td></tr><tr><td data-num="97"></td><td><pre>			<span class="token keyword">RETURN</span> OLD<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="98"></td><td><pre>		ELSIF <span class="token punctuation">(</span>TG_OP <span class="token operator">=</span> <span class="token string">'UPDATE'</span><span class="token punctuation">)</span> <span class="token keyword">THEN</span></pre></td></tr><tr><td data-num="99"></td><td><pre>			<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> audit_score	<span class="token keyword">SELECT</span> <span class="token keyword">user</span>， old<span class="token punctuation">.</span>sid<span class="token punctuation">,</span> old<span class="token punctuation">.</span>cid<span class="token punctuation">,</span> <span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>， OLD<span class="token punctuation">.</span>score <span class="token punctuation">,</span> new<span class="token punctuation">.</span>score</pre></td></tr><tr><td data-num="100"></td><td><pre>			<span class="token keyword">where</span> old<span class="token punctuation">.</span>sid<span class="token operator">=</span>new<span class="token punctuation">.</span>sid <span class="token operator">and</span> old<span class="token punctuation">.</span>cid<span class="token operator">=</span>new<span class="token punctuation">.</span>cid<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="101"></td><td><pre>			<span class="token keyword">RETURN</span> NEW<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="102"></td><td><pre>		ELSIF <span class="token punctuation">(</span>TG OP <span class="token operator">=</span> <span class="token string">'INSERT'</span><span class="token punctuation">)</span> <span class="token keyword">THEN</span></pre></td></tr><tr><td data-num="103"></td><td><pre>			<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> audit_score <span class="token keyword">SELECT</span> <span class="token keyword">user</span><span class="token punctuation">,</span> new<span class="token punctuation">.</span>sid<span class="token punctuation">,</span> new<span class="token punctuation">.</span>cid<span class="token punctuation">,</span> <span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token boolean">null</span><span class="token punctuation">,</span>new<span class="token punctuation">.</span>score<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="104"></td><td><pre>			<span class="token keyword">RETURN</span> NEW<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="105"></td><td><pre>		<span class="token keyword">END</span> <span class="token keyword">IF</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="106"></td><td><pre>		<span class="token keyword">RETURN</span> <span class="token boolean">NULL</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="107"></td><td><pre>	<span class="token keyword">END</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="108"></td><td><pre>$score_audit$ <span class="token keyword">LANGUAGE</span> plpgsql<span class="token punctuation">;</span></pre></td></tr></table></figure><h4 id="plsql基本语法"><a class="markdownIt-Anchor" href="#plsql基本语法">#</a> PL/SQl 基本语法</h4><h3 id="64-数据库触发器"><a class="markdownIt-Anchor" href="#64-数据库触发器">#</a> 6.4 数据库触发器</h3><p>触发器是一个定义在表或视图上的特殊类型的存储过程（不传递接受参数）、一个特殊的事务单位，由操作事件触发自动执行，可以实现比约束更复杂的数据完整性，用于加强数据完整性约束和业务规则</p><p>语句级触发器只执行一次（默认触发器）；行级触发器每有数据变化一行就执行一次</p><p>INSTEAD OF 触发器：事件发生时只执行触发器不执行原本的 sql 语句，一个表或视图只能有一个 INSTEAD OF 触发器</p><h4 id="触发器相关特殊变量"><a class="markdownIt-Anchor" href="#触发器相关特殊变量">#</a> 触发器相关特殊变量</h4><p>NEW：RECORD 类型，对于行级触发器其存有 INSERT 或 UPDATE 操作产生的新数据行。对于语句级触发器其值为 NULL</p><p>OLD：RECORD 类型，对于行级触发器其存有 DELETE 或 UPDATE 操作修改或删除的旧数据行。对于语句级触发器其值为 NULL</p><p>TG_OP:text 类型，值为 INSERT/UPDATE/DELETE，说明引发触发器的操作</p><p>创建触发器步骤：</p><ol><li>检查所依附的表或视图是否存在</li><li>创建触发器执行的触发器函数，返回类型为 TRIGGER</li><li>创建触发器</li></ol><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">CREATE</span>  <span class="token keyword">TRIGGER</span>  触发器名   </pre></td></tr><tr><td data-num="2"></td><td><pre>    &#123; BEFORE <span class="token operator">|</span> <span class="token keyword">AFTER</span> <span class="token operator">|</span> INSTEAD <span class="token keyword">OF</span> &#125;</pre></td></tr><tr><td data-num="3"></td><td><pre>     <span class="token keyword">ON</span> 表名</pre></td></tr><tr><td data-num="4"></td><td><pre>     <span class="token punctuation">[</span> <span class="token keyword">FOR</span> <span class="token punctuation">[</span> EACH <span class="token punctuation">]</span> &#123; <span class="token keyword">ROW</span> <span class="token operator">|</span> STATEMENT &#125; <span class="token punctuation">]</span></pre></td></tr><tr><td data-num="5"></td><td><pre>     <span class="token keyword">EXECUTE</span> <span class="token keyword">PROCEDURE</span> 存储过程名 <span class="token punctuation">(</span> 参数列表 <span class="token punctuation">)</span></pre></td></tr></table></figure><p>实例 为了防止非法修改 stu_score 表的课程成绩，创建 audit_score 表记录 stu_score 表的成绩变化</p><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">-- 创建表</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> stu_score</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">(</span> </pre></td></tr><tr><td data-num="4"></td><td><pre>    sid <span class="token keyword">character</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    cid <span class="token keyword">character</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    score <span class="token keyword">numeric</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">CONSTRAINT</span> stu_score_pkey <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>sid<span class="token punctuation">,</span> cid<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> audit_score</pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">(</span>    username <span class="token keyword">character</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token punctuation">,</span>  <span class="token comment">-- 用户名</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    sid <span class="token keyword">character</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">,</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    cid <span class="token keyword">character</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">,</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    updatetime <span class="token keyword">text</span> <span class="token punctuation">,</span>            <span class="token comment">-- 修改的时间</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    oldscore <span class="token keyword">numeric</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>   <span class="token comment">-- 修改前的成绩</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    newscore <span class="token keyword">numeric</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment">-- 修改后的成绩</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token comment">-- 创建函数</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token keyword">CREATE</span> <span class="token operator">OR</span> <span class="token keyword">REPLACE</span> <span class="token keyword">FUNCTION</span> score_audit <span class="token keyword">RETURNS</span> <span class="token keyword">TRIGGER</span> </pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token keyword">AS</span> $score_sudits$</pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token keyword">BEGIN</span></pre></td></tr><tr><td data-num="21"></td><td><pre>	<span class="token keyword">IF</span> <span class="token punctuation">(</span>TG_OP <span class="token operator">=</span> <span class="token string">'DELETE'</span><span class="token punctuation">)</span> <span class="token keyword">THEN</span></pre></td></tr><tr><td data-num="22"></td><td><pre>		<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> audit_score <span class="token keyword">SELECT</span> <span class="token keyword">user</span><span class="token punctuation">,</span>old<span class="token punctuation">.</span>sid<span class="token punctuation">,</span>old<span class="token punctuation">.</span>cid<span class="token punctuation">,</span>OLD<span class="token punctuation">.</span>score <span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>		<span class="token keyword">RETURN</span> OLD<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>	ELSIF <span class="token punctuation">(</span>TG_OP <span class="token operator">=</span> <span class="token string">'UPDATE'</span><span class="token punctuation">)</span> <span class="token keyword">THEN</span></pre></td></tr><tr><td data-num="25"></td><td><pre>		<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> audit_score</pre></td></tr><tr><td data-num="26"></td><td><pre>		<span class="token keyword">SELECT</span> <span class="token keyword">user</span><span class="token punctuation">,</span>old<span class="token punctuation">.</span>sid<span class="token punctuation">,</span>old<span class="token punctuation">.</span>cid<span class="token punctuation">,</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>OLD<span class="token punctuation">.</span>score<span class="token punctuation">,</span>new<span class="token punctuation">.</span>score</pre></td></tr><tr><td data-num="27"></td><td><pre>		<span class="token keyword">WHERE</span> old<span class="token punctuation">.</span>sid<span class="token operator">=</span>new<span class="token punctuation">.</span>sid <span class="token operator">and</span> old<span class="token punctuation">.</span>cid<span class="token operator">=</span>new<span class="token punctuation">.</span>cid<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>		<span class="token keyword">RETURN</span> NEW</pre></td></tr><tr><td data-num="29"></td><td><pre>	ELSIF <span class="token punctuation">(</span>TG_OP <span class="token operator">=</span> <span class="token string">'INSERT'</span><span class="token punctuation">)</span> <span class="token keyword">THEN</span></pre></td></tr><tr><td data-num="30"></td><td><pre>		<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> audit_score <span class="token keyword">SELECT</span> <span class="token keyword">user</span><span class="token punctuation">,</span>new<span class="token punctuation">.</span>sid<span class="token punctuation">,</span>new<span class="token punctuation">.</span>cid<span class="token punctuation">,</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token boolean">null</span><span class="token punctuation">,</span>new<span class="token punctuation">.</span>score<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="31"></td><td><pre>		<span class="token keyword">RETURN</span> NEW<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>	<span class="token keyword">END</span> <span class="token keyword">IF</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>	<span class="token keyword">RETURN</span> <span class="token boolean">NULL</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="34"></td><td><pre><span class="token keyword">END</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="35"></td><td><pre>$score_audits$ <span class="token keyword">LANGUAGE</span> plpgsql<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="36"></td><td><pre><span class="token comment">-- 创建触发器</span></pre></td></tr><tr><td data-num="37"></td><td><pre><span class="token keyword">CREATE</span> <span class="token keyword">TRIGGER</span> score_audit_triger</pre></td></tr><tr><td data-num="38"></td><td><pre><span class="token keyword">AFTER</span> <span class="token keyword">INSERT</span> <span class="token operator">OR</span> <span class="token keyword">UPDATE</span> <span class="token operator">OR</span> <span class="token keyword">DELETE</span> <span class="token keyword">ON</span> stu_score</pre></td></tr><tr><td data-num="39"></td><td><pre><span class="token keyword">FOR EACH ROW</span> <span class="token keyword">EXECUTE</span> <span class="token keyword">PROCEDURE</span> score_audit<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="40"></td><td><pre><span class="token comment">-- 修改触发器</span></pre></td></tr><tr><td data-num="41"></td><td><pre><span class="token keyword">ALTER</span> <span class="token keyword">TRIGGER</span> score_audit_trigger <span class="token keyword">ON</span> stu_score  <span class="token keyword">RENAME</span> <span class="token keyword">TO</span> score_audit_trig<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="42"></td><td><pre><span class="token comment">-- 删除触发器</span></pre></td></tr><tr><td data-num="43"></td><td><pre><span class="token keyword">DROP</span> <span class="token keyword">TRIGGER</span> <span class="token punctuation">[</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> <span class="token punctuation">]</span> name <span class="token keyword">ON</span> table_name <span class="token punctuation">[</span> <span class="token keyword">CASCADE</span> <span class="token operator">|</span> <span class="token keyword">RESTRICT</span> <span class="token punctuation">]</span></pre></td></tr><tr><td data-num="44"></td><td><pre></pre></td></tr><tr><td data-num="45"></td><td><pre><span class="token keyword">DROP</span> <span class="token keyword">TRIGGER</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> score_audit_trig <span class="token keyword">ON</span> stu_score <span class="token keyword">CASCADE</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h3 id="65-数据库游标"><a class="markdownIt-Anchor" href="#65-数据库游标">#</a> 6.5 数据库游标</h3><p>游标是一种存放了查询数据库表返回的数据记录的临时的数据库对象，包含查询结果和指针，提供了处理结果集中每一条记录的机制，它总是与一条查询 SQL 语句相关联</p><p>声明游标</p><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">-- 声明游标</span></pre></td></tr><tr><td data-num="2"></td><td><pre>curStudent <span class="token keyword">CURSOR</span> <span class="token keyword">FOR</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> student<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>curStudentOne <span class="token keyword">CURSOR</span> <span class="token punctuation">(</span><span class="token keyword">key</span> <span class="token keyword">integer</span><span class="token punctuation">)</span><span class="token number">7</span>y <span class="token operator">IS</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> student <span class="token keyword">WHERE</span> SID <span class="token operator">=</span> <span class="token keyword">key</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>打开游标</p><p>使用游标</p><p>关闭游标</p><p>实例</p><h3 id="66-嵌入式sql编程"><a class="markdownIt-Anchor" href="#66-嵌入式sql编程">#</a> 6.6 嵌入式 sql 编程</h3><p>sql 与宿主语言，混合编程</p><h2 id="七-nosql数据库技术"><a class="markdownIt-Anchor" href="#七-nosql数据库技术">#</a> 七、NoSQL 数据库技术</h2><h3 id="大数据5v特征"><a class="markdownIt-Anchor" href="#大数据5v特征">#</a> 大数据 5V 特征</h3><ul><li>超量 Volume</li><li>高速 Velocity</li><li>异构 Variety</li><li>真实 Veracity</li><li>价值 Value</li></ul><h3 id="cap理论"><a class="markdownIt-Anchor" href="#cap理论">#</a> CAP 理论</h3><p>在分布式的环境下设计和部署系统时，有 3 个核心的需求：CAP 对应一致性（Consistency），可用性（Availability）和分区容忍性（Partition Tolerance）</p><p>CAP 理论的核心：</p><p>一个分布式系统不可能同时很好的满足一致性、可用性和分区容错性这三个需求，最多只能同时较好的满足两个。</p><ul><li>CA - 单点集群，满足一致性，可用性的系统，</li><li>CP - 满足一致性，分区容忍性的系统，</li><li>AP - 满足可用性，分区容忍性的系统，</li></ul><p>CAP 目的：</p><ul><li>CAP 是为了探索不同应用的一致性 C 与可用性 A 之间的平衡，</li><li>在网络或其他原因，通过牺牲一定的一致性 C 来获得更好的性能与扩展性</li><li>在有分隔发生，选择可用性 A，集中关注分隔的恢复，需要分隔前、中、后期的处理策略， 及合适的补偿处理机制。</li><li>选择什么样的方式： 放弃Ｐ？放弃Ａ？放弃Ｃ？BASE</li></ul><h3 id="base"><a class="markdownIt-Anchor" href="#base">#</a> BASE</h3><ul><li>Basically Available -- 基本可用；系统能够基本运行，一直提供服务。</li><li>Soft-state -- 软状态 / 柔性事务。“Soft state” 可以理解为 &quot;无连接&quot; 的，而 “Hard state” 是 &quot;面向连接&quot; 的；系统不要求一直保持强一致状态。</li><li>Eventual Consistency -- 最终一致性 系统在某个时刻达到最终一致性。</li><li>BASE 定义为 CAP 中 AP 的衍生，在分布式环境下， BASE 是数据的属性，BASE 强调基本的可用性，按照功能划分数据库</li></ul><p>base 特点</p><ul><li>ACID 是事物的特征， A（原子性）C（一致性）I（隔离性）D（持久性），ACID 的特点是强一致性、隔离性、采用悲观保守方法、难以变化；</li><li>BASE 的特点是弱一致性、可用性优先、采用乐观方法、适应变化并且简单快捷。</li><li>对数据不断增长的系统， 大数据环境下系统的可用性及分隔容忍性的要求要高于强一致性，很难满足事务要求的 ACID 特性。</li></ul><h3 id="最终一致性"><a class="markdownIt-Anchor" href="#最终一致性">#</a> 最终一致性</h3><ul><li>强一致性： 要求无论更新操作实在哪一个副本执行，之后所有的读操作都要能获得最新的数据。</li><li>弱一致性：用户读到某一操作对系统特定数据的更新需要一段时间，称这段时间为 “不一致性窗口”。</li><li>最终一致性： 弱一致性的一种特例，保证用户最终能够读取到某操作对系统特定数据的更新。</li></ul><h3 id="存储模型"><a class="markdownIt-Anchor" href="#存储模型">#</a> 存储模型</h3><ul><li>列存储数据库，将同一列的数据存储在一起，可以存储结构化和半结构化数据</li><li>键值存储数据库，存储的数据是有键（key）和值（value）两部分组成，通过 key 快速查询到其 value，value 的格式可以根据具体应用来确定</li><li>文档存储数据库，存储的内容是文档型的，可以用格式化文件（类似 json、XML 等）的格式存储</li><li>图存储数据库，数据以有向加权图方式进行存储</li></ul><table><thead><tr><th><strong>分类</strong></th><th><strong>Examples**** 举例</strong></th><th><strong>典型应用场景</strong></th><th><strong>数据模型</strong></th><th><strong>优点</strong></th><th><strong>缺点</strong></th></tr></thead><tbody><tr><td>键值 （key-value）</td><td>Tokyo Cabinet/Tyrant, Redis, Voldemort, Oracle BDB</td><td>内容缓存，主要用于处理大量数据的高访问负载，也用于一些日志系统等等</td><td>Key 指向 Value 的键值对，通常用 hash table 来实现</td><td>查找速度快</td><td>数据无结构化，通常只被当作字符串或者二进制数据</td></tr><tr><td>列存储数据库</td><td>Cassandra, HBase, Riak</td><td>分布式的文件系统</td><td>以列簇式存储，将同一列数据存在一起</td><td>查找速度快，可扩展性强，更容易进行分布式扩展</td><td>功能相对局限</td></tr><tr><td>文档型数据库</td><td>CouchDB, MongoDb</td><td>与 Key-Value 类似，Value 是结构化的，不同的是数据库能够了解 Value 的内容</td><td>Key-Value 对应的键值对，Value 为结构化数据</td><td>数据结构要求不严格，表结构可变，不需要像关系型数据库一样需要预先定义表结构</td><td>查询性能不高，而且缺乏统一的查询语法。</td></tr><tr><td>图形 (Graph) 数据库</td><td>Neo4J, InfoGrid, Infinite Graph</td><td>社交网络，推荐系统等。专注于构建关系图谱</td><td>图结构</td><td>利用图结构相关算法。比如最短路径寻址，N 度关系查找等</td><td>很多时候需要对整个图做计算才能得出需要的信息，而且这种结构不太好做分布式的集群方案</td></tr></tbody></table><div class="tags"><a href="/tags/%E5%AD%A6%E4%B9%A0/" rel="tag"><i class="ic i-tag"></i> 学习</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">更新于</span> <time title="修改时间：2024-08-03 20:04:35" itemprop="dateModified" datetime="2024-08-03T20:04:35+08:00">2024-08-03</time> </span><span id="2024/06/20/数据库复习/" class="item leancloud_visitors" data-flag-title="数据库复习" title="阅读次数"><span class="icon"><i class="ic i-eye"></i> </span><span class="text">阅读次数</span> <span class="leancloud-visitors-count"></span> <span class="text">次</span></span></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong>Tviak <i class="ic i-at"><em>@</em></i>Tviak的普通观测站</li><li class="link"><strong>本文链接：</strong> <a href="https://blog.vktia.me/2024/06/20/%E6%95%B0%E6%8D%AE%E5%BA%93%E5%A4%8D%E4%B9%A0/" title="数据库复习">https://blog.vktia.me/2024/06/20/数据库复习/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/2024/06/20/os/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;cdn.jsdelivr.net&#x2F;gh&#x2F;TV233&#x2F;blogpic@master&#x2F;img&#x2F;100316398_pa0.jpg" title="操作系统复习"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i></span><h3>操作系统复习</h3></a></div><div class="item right"><a href="/2024/06/20/%E8%BD%AF%E4%BB%B6%E5%B7%A5%E7%A8%8B%E5%A4%8D%E4%B9%A01/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;cdn.jsdelivr.net&#x2F;gh&#x2F;TV233&#x2F;blogpic@master&#x2F;img&#x2F;98805155_pa0.jpg" title="软件工程复习"><span class="type">下一篇</span> <span class="category"><i class="ic i-flag"></i></span><h3>软件工程复习</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80-%E6%95%B0%E6%8D%AE%E5%BA%93%E5%8F%8A%E5%85%B6%E7%B3%BB%E7%BB%9F%E6%A6%82%E5%BF%B5"><span class="toc-number">1.</span> <span class="toc-text">一、数据库及其系统概念</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C-%E5%85%B3%E7%B3%BB%E6%A8%A1%E5%9E%8B"><span class="toc-number">2.</span> <span class="toc-text">二、关系模型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#21-%E5%85%B3%E7%B3%BB%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5"><span class="toc-number">2.1.</span> <span class="toc-text">2.1 关系相关概念</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#22-%E5%85%B3%E7%B3%BB%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86"><span class="toc-number">2.2.</span> <span class="toc-text">2.2 关系模型原理</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89-sql%E8%AF%AD%E5%8F%A5"><span class="toc-number">3.</span> <span class="toc-text">三、SQL 语句</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#31-sql%E6%A6%82%E8%BF%B0"><span class="toc-number">3.1.</span> <span class="toc-text">3.1 sql 概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#32-%E6%95%B0%E6%8D%AE%E5%AE%9A%E4%B9%89%E8%AF%AD%E5%8F%A5"><span class="toc-number">3.2.</span> <span class="toc-text">3.2 数据定义语句</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">3.2.1.</span> <span class="toc-text">数据库</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E8%A1%A8"><span class="toc-number">3.2.2.</span> <span class="toc-text">数据库表</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B4%A2%E5%BC%95"><span class="toc-number">3.2.3.</span> <span class="toc-text">数据库索引</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#33-%E6%95%B0%E6%8D%AE%E6%93%8D%E7%BA%B5%E8%AF%AD%E5%8F%A5"><span class="toc-number">3.3.</span> <span class="toc-text">3.3 数据操纵语句</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E6%8F%92%E5%85%A5"><span class="toc-number">3.3.1.</span> <span class="toc-text">数据插入</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E4%BF%AE%E6%94%B9"><span class="toc-number">3.3.2.</span> <span class="toc-text">数据修改</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%88%A0%E9%99%A4"><span class="toc-number">3.3.3.</span> <span class="toc-text">数据删除</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#34-%E6%95%B0%E6%8D%AE%E6%9F%A5%E8%AF%A2%E8%AF%AD%E5%8F%A5"><span class="toc-number">3.4.</span> <span class="toc-text">3.4 数据查询语句</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8D%95%E8%A1%A8%E6%9F%A5%E8%AF%A2"><span class="toc-number">3.4.1.</span> <span class="toc-text">单表查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%9A%E8%A1%A8%E5%85%B3%E8%81%94%E6%9F%A5%E8%AF%A2"><span class="toc-number">3.4.2.</span> <span class="toc-text">多表关联查询</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B-%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1"><span class="toc-number">4.</span> <span class="toc-text">四、数据库设计</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#41-%E6%A6%82%E8%BF%B0"><span class="toc-number">4.1.</span> <span class="toc-text">4.1 概述</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E5%BC%80%E5%8F%91%E8%BF%87%E7%A8%8B"><span class="toc-number">4.1.1.</span> <span class="toc-text">数据库开发过程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E7%BB%93%E6%9E%84%E6%A8%A1%E5%9E%8B%E8%AE%BE%E8%AE%A1-%E6%95%B0%E6%8D%AE%E5%BA%93%E7%BB%93%E6%9E%84%E6%A8%A1%E5%9E%8B"><span class="toc-number">4.1.2.</span> <span class="toc-text">数据库结构模型设计 - 数据库结构模型</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#42-e-r%E6%A8%A1%E5%9E%8B%E6%96%B9%E6%B3%95"><span class="toc-number">4.2.</span> <span class="toc-text">4.2 E-R 模型方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#43-%E6%95%B0%E6%8D%AE%E5%BA%93%E5%BB%BA%E6%A8%A1%E8%AE%BE%E8%AE%A1"><span class="toc-number">4.3.</span> <span class="toc-text">4.3 数据库建模设计</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A6%82%E5%BF%B5%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B"><span class="toc-number">4.3.1.</span> <span class="toc-text">概念数据模型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#cdmldmpdm%E6%A8%A1%E5%9E%8B%E8%BD%AC%E6%8D%A2%E8%AE%BE%E8%AE%A1"><span class="toc-number">4.3.2.</span> <span class="toc-text">CDM&#x2F;LDM&#x2F;PDM 模型转换设计</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#44-%E6%95%B0%E6%8D%AE%E5%BA%93%E8%A7%84%E8%8C%83%E5%8C%96%E8%AE%BE%E8%AE%A1"><span class="toc-number">4.4.</span> <span class="toc-text">4.4 数据库规范化设计</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E4%BE%9D%E8%B5%96%E7%90%86%E8%AE%BA"><span class="toc-number">4.4.1.</span> <span class="toc-text">函数依赖理论</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B3%E7%B3%BB%E8%A7%84%E8%8C%83%E5%8C%96%E8%8C%83%E5%BC%8F"><span class="toc-number">4.4.2.</span> <span class="toc-text">关系规范化范式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%86%E8%A7%84%E8%8C%83%E5%8C%96%E5%A4%84%E7%90%86"><span class="toc-number">4.4.3.</span> <span class="toc-text">逆规范化处理</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94-%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AE%A1%E7%90%86"><span class="toc-number">5.</span> <span class="toc-text">五、数据库管理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#51-%E6%A6%82%E8%BF%B0"><span class="toc-number">5.1.</span> <span class="toc-text">5.1 概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#52-%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86"><span class="toc-number">5.2.</span> <span class="toc-text">5.2 事务管理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#53-%E5%B9%B6%E5%8F%91%E6%8E%A7%E5%88%B6"><span class="toc-number">5.3.</span> <span class="toc-text">5.3 并发控制</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1%E8%B0%83%E5%BA%A6"><span class="toc-number">5.3.1.</span> <span class="toc-text">事务调度</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E4%B8%8D%E4%B8%80%E8%87%B4%E9%97%AE%E9%A2%98"><span class="toc-number">5.3.1.1.</span> <span class="toc-text">数据不一致问题</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%94%81%E6%9C%BA%E5%88%B6"><span class="toc-number">5.3.2.</span> <span class="toc-text">锁机制</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8A%A0%E9%94%81%E5%8D%8F%E8%AE%AE"><span class="toc-number">5.3.2.1.</span> <span class="toc-text">加锁协议</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%B8%A4%E9%98%B6%E6%AE%B5%E9%94%81%E5%AE%9A%E5%8D%8F%E8%AE%AE"><span class="toc-number">5.3.2.2.</span> <span class="toc-text">两阶段锁定协议</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%AD%BB%E9%94%81"><span class="toc-number">5.3.3.</span> <span class="toc-text">死锁</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB"><span class="toc-number">5.3.4.</span> <span class="toc-text">事务隔离</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#54-%E5%AE%89%E5%85%A8%E7%AE%A1%E7%90%86"><span class="toc-number">5.4.</span> <span class="toc-text">5.4 安全管理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%98%E5%8F%96%E5%AE%89%E5%85%A8%E6%A8%A1%E5%9E%8B"><span class="toc-number">5.4.1.</span> <span class="toc-text">存取安全模型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E5%AE%89%E5%85%A8%E6%A8%A1%E5%9E%8B"><span class="toc-number">5.4.2.</span> <span class="toc-text">系统安全模型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E7%AE%A1%E7%90%86"><span class="toc-number">5.4.3.</span> <span class="toc-text">用户管理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86"><span class="toc-number">5.4.4.</span> <span class="toc-text">权限管理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%92%E8%89%B2%E7%AE%A1%E7%90%86"><span class="toc-number">5.4.5.</span> <span class="toc-text">角色管理</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#55-%E6%95%B0%E6%8D%AE%E5%BA%93%E5%A4%87%E4%BB%BD%E4%B8%8E%E6%81%A2%E5%A4%8D"><span class="toc-number">5.5.</span> <span class="toc-text">5.5 数据库备份与恢复</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AD-%E6%95%B0%E6%8D%AE%E5%BA%93%E5%BA%94%E7%94%A8%E7%BC%96%E7%A8%8B"><span class="toc-number">6.</span> <span class="toc-text">六、数据库应用编程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#61-%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9E%E6%8E%A5%E6%8A%80%E6%9C%AFjdbc"><span class="toc-number">6.1.</span> <span class="toc-text">6.1 数据库连接技术（JDBC）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A6%82%E5%BF%B5"><span class="toc-number">6.1.1.</span> <span class="toc-text">概念</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%86%E7%BA%A7"><span class="toc-number">6.1.2.</span> <span class="toc-text">分级</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#jdbc%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93%E6%AD%A5%E9%AA%A4"><span class="toc-number">6.1.3.</span> <span class="toc-text">JDBC 访问数据库步骤</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#62-%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B"><span class="toc-number">6.2.</span> <span class="toc-text">6.2 数据库存储过程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#plsql%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95"><span class="toc-number">6.2.1.</span> <span class="toc-text">PL&#x2F;SQl 基本语法</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#64-%E6%95%B0%E6%8D%AE%E5%BA%93%E8%A7%A6%E5%8F%91%E5%99%A8"><span class="toc-number">6.3.</span> <span class="toc-text">6.4 数据库触发器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A6%E5%8F%91%E5%99%A8%E7%9B%B8%E5%85%B3%E7%89%B9%E6%AE%8A%E5%8F%98%E9%87%8F"><span class="toc-number">6.3.1.</span> <span class="toc-text">触发器相关特殊变量</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#65-%E6%95%B0%E6%8D%AE%E5%BA%93%E6%B8%B8%E6%A0%87"><span class="toc-number">6.4.</span> <span class="toc-text">6.5 数据库游标</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#66-%E5%B5%8C%E5%85%A5%E5%BC%8Fsql%E7%BC%96%E7%A8%8B"><span class="toc-number">6.5.</span> <span class="toc-text">6.6 嵌入式 sql 编程</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%83-nosql%E6%95%B0%E6%8D%AE%E5%BA%93%E6%8A%80%E6%9C%AF"><span class="toc-number">7.</span> <span class="toc-text">七、NoSQL 数据库技术</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%A7%E6%95%B0%E6%8D%AE5v%E7%89%B9%E5%BE%81"><span class="toc-number">7.1.</span> <span class="toc-text">大数据 5V 特征</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#cap%E7%90%86%E8%AE%BA"><span class="toc-number">7.2.</span> <span class="toc-text">CAP 理论</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#base"><span class="toc-number">7.3.</span> <span class="toc-text">BASE</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%80%E7%BB%88%E4%B8%80%E8%87%B4%E6%80%A7"><span class="toc-number">7.4.</span> <span class="toc-text">最终一致性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E6%A8%A1%E5%9E%8B"><span class="toc-number">7.5.</span> <span class="toc-text">存储模型</span></a></li></ol></li></ol></div><div class="related panel pjax" data-title="系列文章"></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="Tviak" data-src="/images/avatar.jpg"><p class="name" itemprop="name">Tviak</p><div class="description" itemprop="description">观测世界和自己的一般通过观测者</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">56</span> <span class="name">文章</span></a></div><div class="item tags"><a href="/tags/"><span class="count">9</span> <span class="name">标签</span></a></div></nav><div class="social"><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL1RWMjMz" title="https:&#x2F;&#x2F;github.com&#x2F;TV233"><i class="ic i-github"></i></span> <span class="exturl item music" data-url="aHR0cHM6Ly9tdXNpYy4xNjMuY29tLyMvdXNlci9ob21lP2lkPTI4MDI1MTMzMQ==" title="https:&#x2F;&#x2F;music.163.com&#x2F;#&#x2F;user&#x2F;home?id&#x3D;280251331"><i class="ic i-cloud-music"></i></span> <span class="exturl item email" data-url="bWFpbHRvOnZrQHZrdGlhLm1l" title="mailto:vk@vktia.me"><i class="ic i-envelope"></i></span> <span class="exturl item bilibili" data-url="aHR0cHM6Ly9zcGFjZS5iaWxpYmlsaS5jb20vNzk4ODU0MQ==" title="https:&#x2F;&#x2F;space.bilibili.com&#x2F;7988541"><i class="ic i-youtube"></i></span></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>主页</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-user"></i>关于</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li><li class="item"><a href="/friends/" rel="section"><i class="ic i-heart"></i>友链</a></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/2024/06/20/os/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/2024/06/20/%E8%BD%AF%E4%BB%B6%E5%B7%A5%E7%A8%8B%E5%A4%8D%E4%B9%A01/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"></div><span><a href="/2023/03/03/%E7%88%AC%E8%99%AB%EF%BC%8C%E4%BD%86%E6%98%AF%E6%95%B0%E6%8D%AE%E5%BA%93/" title="爬虫，但是数据库">爬虫，但是数据库</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2024/06/20/os/" title="操作系统复习">操作系统复习</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2024/06/28/GitHub/" title="GitHub 学生包 Proof Type 选项消失解法">GitHub 学生包 Proof Type 选项消失解法</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2024/06/20/qt/" title="C++ &amp; Qt 复习笔记">C++ & Qt 复习笔记</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2024/10/17/20241017/" title="爱来自Arch Linux">爱来自Arch Linux</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2023/07/27/day2/" title="前端与HTML 青训营前端基础班 Day2">前端与HTML 青训营前端基础班 Day2</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2020/04/25/%E6%B5%8B%E8%AF%95/" title="233">233</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2022/06/23/20220623/" title="20220623">20220623</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2023/07/22/CSS%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" title="CSS学习笔记">CSS学习笔记</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2024/08/03/20240803/" title="复活以及我在干嘛">复活以及我在干嘛</a></span></li></ul></div><div><h2>最新评论</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2020 – <span itemprop="copyrightYear">2025</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">Tviak @ Tviak's Observatory</span></div><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="站点总字数">215k 字</span> <span id="busuanzi_container_site_pv">本站总访问量<span id="busuanzi_value_site_pv"></span>次</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="站点阅读时长">4:53</span></div><p id="hitokoto"><a href="#" id="hitokoto_text">:D 获取中...</a></p><script>fetch('https://v1.hitokoto.cn')
    .then(response => response.json())
    .then(data => {
      const hitokoto = document.querySelector('#hitokoto_text')
      hitokoto.href = `https://hitokoto.cn/?uuid=${data.uuid}`
      hitokoto.innerText = data.hitokoto
    })
    .catch(console.error)</script><div class="powered-by">基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span><br><a href="https://icp.gov.moe/?keyword=20237705" target="_blank">萌ICP备20237705号</a></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"2024/06/20/数据库复习/",favicon:{show:"（●´3｀●）",hide:"(´Д｀)"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://polyfill.alicdn.com/polyfill.min.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script></body></html>